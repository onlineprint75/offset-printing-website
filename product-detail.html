<!DOCTYPE html>
<html lang="mn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPM | Бүтээгдэхүүний дэлгэрэнгүй</title>
    <link rel="icon" type="image/svg+xml" href="assets/images/Logo--ani-02.svg" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>
    <header>
        <div class="container" style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
            <a href="index.html" class="logo">
                <img src="assets/images/logo.png" alt="OFFSET PRINT Logo">
            </a>

            <div class="header-right">
                <div class="mobile-menu-header">
                    <img src="assets/images/logo.png" alt="PPM Logo" class="mobile-logo">
                    <button class="menu-close-btn" id="menu-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mobile-menu-card">
                    <div class="nav-pill">
                        <ul>
                            <li><a href="index.html" data-i18n="nav-home">Нүүр</a></li>
                            <li><a href="about.html" data-i18n="nav-about">Бидний тухай</a></li>
                            <li><a href="inventory.html" data-i18n="nav-inventory">Бараа материал</a></li>
                            <li><a href="contact.html" data-i18n="nav-contact">Холбоо барих</a></li>
                        </ul>
                        <a href="quote.html" class="btn-pill" data-i18n="nav-quote">Үнийн санал авах</a>
                    </div>

                    <div class="menu-divider"></div>

                    <div class="support-info">
                        <span class="phone">7575-8575</span>
                        <span class="label" data-i18n="support-text">Хэрэглэгчийн туслах</span>
                    </div>

                    <div class="lang-switcher" id="lang-switcher">
                        <div class="lang-btn" id="lang-btn">
                            <img src="https://flagcdn.com/w20/mn.png" id="current-lang-flag">
                            <span id="current-lang-name">Монгол</span>
                            <i class="fas fa-chevron-down" style="font-size: 0.7rem; margin-left: 5px;"></i>
                        </div>
                        <div class="lang-dropdown" id="lang-dropdown">
                            <div class="lang-option active" data-lang="mn">
                                <img src="https://flagcdn.com/w20/mn.png"> Монгол
                            </div>
                            <div class="lang-option" data-lang="en">
                                <img src="https://flagcdn.com/w20/gb.png"> English
                            </div>
                            <div class="lang-option" data-lang="zh">
                                <img src="https://flagcdn.com/w20/cn.png"> 中文
                            </div>
                            <div class="lang-option" data-lang="ko">
                                <img src="https://flagcdn.com/w20/kr.png"> 한국어
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div class="menu-overlay" id="menu-overlay"></div>
        <script src="translations.js"></script>
        <script>
            // Mobile Menu Logic
            const menuToggle = document.getElementById('menu-toggle');
            const menuClose = document.getElementById('menu-close');
            const navMenu = document.querySelector('.header-right');
            const menuOverlay = document.getElementById('menu-overlay');

            function openMenu() {
                navMenu.classList.add('active');
                menuOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function closeMenu() {
                navMenu.classList.remove('active');
                menuOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            function toggleMenu() {
                if (navMenu.classList.contains('active')) {
                    closeMenu();
                } else {
                    openMenu();
                }
            }

            menuToggle.addEventListener('click', toggleMenu);
            menuClose.addEventListener('click', closeMenu);
            menuOverlay.addEventListener('click', closeMenu);

            // Swipe to Close Logic (Left to Right)
            let touchStartX = 0;
            let touchEndX = 0;

            document.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });

            document.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: true });

            function handleSwipe() {
                const SWIPE_THRESHOLD = 50;
                const swipeDistance = touchEndX - touchStartX;
                if (navMenu.classList.contains('active') && swipeDistance > SWIPE_THRESHOLD) {
                    closeMenu();
                }
            }


            // Language Switcher Logic
            const langBtn = document.getElementById('lang-btn');
            const langDropdown = document.getElementById('lang-dropdown');
            const langOptions = document.querySelectorAll('.lang-option');

            langBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                langDropdown.classList.toggle('active');
            });

            document.addEventListener('click', () => {
                langDropdown.classList.remove('active');
            });

            langOptions.forEach(opt => {
                opt.addEventListener('click', () => {
                    const lang = opt.getAttribute('data-lang');
                    const flag = opt.querySelector('img').src;
                    const name = opt.textContent.trim();

                    document.getElementById('current-lang-flag').src = flag;
                    document.getElementById('current-lang-name').textContent = name;

                    setLanguage(lang);
                    langDropdown.classList.remove('active');
                });
            });

            // Initialize correct flag/name on load
            window.addEventListener('load', () => {
                const savedLang = localStorage.getItem('preferred-lang') || 'mn';
                const activeOpt = document.querySelector(`.lang-option[data-lang="${savedLang}"]`);
                if (activeOpt) {
                    document.getElementById('current-lang-flag').src = activeOpt.querySelector('img').src;
                    document.getElementById('current-lang-name').textContent = activeOpt.textContent.trim();
                }
            });
        </script>
    </header>

    <main style="padding-top: var(--header-height);">
        <section class="product-detail-section">
            <div class="page-container">
                <nav class="breadcrumb">
                    <a href="index.html" data-i18n="nav-home">Нүүр</a>
                    <span>/</span>
                    <a href="quote.html" data-i18n="nav-quote">Үнийн санал авах</a>
                    <span>/</span>
                    <span data-i18n="product-name-card">Нэрийн хуудас</span>
                </nav>
            </div>
            <div class="page-container product-detail-container">
                <!-- Left: Image Gallery -->
                <div class="product-gallery">
                    <div class="main-image">
                        <img src="assets/images/business_card.jpg" id="current-main-img" alt="Business Card Detail">
                    </div>
                    <div class="thumbnail-grid">
                        <div class="thumb active" onclick="changeImage('assets/images/business_card.jpg', this)">
                            <img src="assets/images/business_card.jpg" alt="Thumbnail 1">
                        </div>
                        <div class="thumb" onclick="changeImage('assets/images/business_card_2.jpg', this)">
                            <img src="assets/images/business_card_2.jpg" alt="Thumbnail 2">
                        </div>
                        <div class="thumb" onclick="changeImage('assets/images/business_card_3.jpg', this)">
                            <img src="assets/images/business_card_3.jpg" alt="Thumbnail 3">
                        </div>
                    </div>
                </div>

                <!-- Right: Product Quote Form -->
                <div class="product-form-card">
                    <h2 data-i18n="product-name-card">Нэрийн хуудас</h2>
                    <form id="quote-form" class="detail-form">
                        <div class="form-group" id="format-group">
                            <label data-i18n="form-format">Хэмжээ</label>
                            <select name="format" id="format-select">
                                <option data-i18n="form-format-std1">Стандарт (90×55мм)</option>
                                <option data-i18n="form-format-std2">Стандарт (85×55мм)</option>
                            </select>
                        </div>

                        <div class="form-group" id="quantity-group">
                            <label data-i18n="form-quantity">Тоо ширхэг</label>
                            <select name="quantity" id="quantity-select">
                                <option>300</option>
                                <option>500</option>
                                <option>1000</option>
                                <option>5000</option>
                                <option>10000</option>
                            </select>
                        </div>

                        <div class="form-group" id="pages-group" style="display: none;">
                            <label data-i18n="form-pages">Нүүрний тоо</label>
                            <select name="pages" id="pages-select">
                                <option data-i18n="form-pages-8">8 нүүр</option>
                                <option data-i18n="form-pages-12">12 нүүр</option>
                                <option data-i18n="form-pages-16">16 нүүр</option>
                            </select>
                        </div>

                        <div class="form-group" id="cover-group" style="display: none;">
                            <label data-i18n="form-cover">Хавтаслалт</label>
                            <select name="cover" id="cover-select">
                                <option data-i18n="form-cover-200">200гр</option>
                                <option data-i18n="form-cover-250">250гр</option>
                            </select>
                        </div>

                        <div class="form-group" id="paper-group">
                            <label data-i18n="form-paper">Цаасны төрөл</label>
                            <select name="paper" id="paper-select">
                                <option>300 (гр)</option>
                                <option>Арт 300 (гр)</option>
                            </select>
                        </div>

                        <div class="form-group" id="prepress-group">
                            <label data-i18n="form-prepress">Эх бэлтгэл байгаа эсэх</label>
                            <select name="prepress">
                                <option data-i18n="form-yes">Тийм</option>
                                <option data-i18n="form-no">Үгүй</option>
                            </select>
                        </div>

                        <div class="form-group" id="coating-group">
                            <label data-i18n="form-coating">Бүрэлтний төрөл</label>
                            <select name="coating">
                                <option data-i18n="form-coating-none">Бүрэлтгүй</option>
                                <option data-i18n="form-coating-matte">Матт бүрэлттэй</option>
                                <option data-i18n="form-coating-glossy">Гялгар бүрэлттэй</option>
                                <option data-i18n="form-coating-suede">Илгэн бүрэлттэй</option>
                            </select>
                        </div>

                        <div class="form-checkbox-group" id="varnish-group" style="display: none;">
                            <label class="checkbox-container">
                                <input type="checkbox" name="varnish">
                                <span class="checkmark"></span>
                                <span data-i18n="form-varnish">Лак бүрэлт хийх</span>
                            </label>
                        </div>

                        <div class="form-group" id="delivery-date-group">
                            <label data-i18n="form-delivery-date">Хүлээн авах хугацаа</label>
                            <input type="date" name="delivery_date" required>
                        </div>

                        <div class="form-group" id="folding-group" style="display: none;">
                            <label data-i18n="form-folding">Нугалааны сонголт</label>
                            <select name="folding">
                                <option data-i18n="form-folding-select">Сонгох</option>
                                <option data-i18n="form-folding-none">Нугалаагүй</option>
                                <option data-i18n="form-folding-1">Нэг нугалаатай</option>
                                <option data-i18n="form-folding-2">2 нугалаатай - Ихэвчлэн 3 нугалбар гэж нэрлэгддэг
                                </option>
                                <option data-i18n="form-folding-3">3 нугалаатай</option>
                                <option data-i18n="form-folding-4">4 нугалаатай</option>
                            </select>
                        </div>

                        <div class="form-group" id="binding-group" style="display: none;">
                            <label data-i18n="form-binding">Нуруулалт</label>
                            <select name="binding">
                                <option data-i18n="form-folding-select">Сонгох</option>
                                <option data-i18n="form-binding-staple">Нуруу үдээтэй</option>
                                <option data-i18n="form-binding-glue">Нуруу наалттай</option>
                            </select>
                        </div>

                        <div class="form-group" id="print-type-group">
                            <label data-i18n="form-print-type">Хэвлэлийн төрөл</label>
                            <select name="print_type">
                                <option data-i18n="form-print-offset">Оффсет хэвлэл</option>
                            </select>
                        </div>

                        <div class="form-checkbox-group" id="spot-uv-group">
                            <label class="checkbox-container">
                                <input type="checkbox" name="spot_uv">
                                <span class="checkmark"></span>
                                <span data-i18n="form-spot-uv">Хэсэгчилсэн лактай ( товгор, гялалзана )</span>
                            </label>
                        </div>

                        <div class="form-checkbox-group" id="foil-group">
                            <label class="checkbox-container">
                                <input type="checkbox" name="foil">
                                <span class="checkmark"></span>
                                <span data-i18n="form-foil">Клиши даралттай ( металл өнгө )</span>
                            </label>
                        </div>

                        <div class="form-group" id="cut-select-group" style="display: none;">
                            <label data-i18n="form-cut">Зүсэлт</label>
                            <select name="cut_select">
                                <option data-i18n="form-cut-select">Зүсэлт хийх</option>
                            </select>
                        </div>

                        <div class="form-checkbox-group" id="cut-checkbox-group" style="display: none;">
                            <label class="checkbox-container">
                                <input type="checkbox" name="cut_checkbox">
                                <span class="checkmark"></span>
                                <span data-i18n="form-cut-select">Зүсэлт хийх</span>
                            </label>
                        </div>

                        <div class="form-checkbox-group" id="numbered-group" style="display: none;">
                            <label class="checkbox-container">
                                <input type="checkbox" name="numbered">
                                <span class="checkmark"></span>
                                <span data-i18n="form-numbered">Номерлогоотой эсэх</span>
                            </label>
                        </div>

                        <div class="form-group">
                            <label data-i18n="form-notes">Тэмдэглэл</label>
                            <textarea name="notes" rows="3" data-i18n-placeholder="form-notes-placeholder"
                                placeholder="Тухайлбар, онцгой хүсэлт..."></textarea>
                        </div>


                        <div class="form-group" id="delivery-info-group" style="display: none;">
                            <label data-i18n="form-delivery-date">Хүргэлт</label>
                            <div class="delivery-badge" data-i18n="form-delivery-1-2">Ажлын 1-2 хоногт</div>
                        </div>

                        <div class="quote-display" id="lamination-price-display" style="display: none;">
                            <div class="label" data-i18n="form-quote-amount">Үнийн дүн (₮)</div>
                            <div class="amount" id="lamination-price">0₮</div>
                        </div>

                        <div class="form-group" id="target-price-group" style="display: none;">
                            <label data-i18n="form-target-price">Үнийн санал (₮)</label>
                            <input type="text" name="target_price" data-i18n-placeholder="form-target-price-placeholder"
                                placeholder="Таны санал болгож буй үнэ (сонголттой)">
                            <small data-i18n="form-target-price-hint"
                                style="display: block; margin-top: 5px; color: #666; font-size: 0.85em;">Таны санал
                                болгож буй үнэ. Хоосон орхиж болно.</small>
                        </div>

                        <button type="submit" class="btn btn-primary submit-order-btn"
                            data-i18n="form-send-order">Хүсэлт илгээх</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <!-- Footer content integrated from index.html -->
        <div class="footer-content">
            <div class="footer-col">
                <h4 data-i18n="footer-company">Продакт Принтинг Монголиа ХХК</h4>
                <p data-i18n="footer-services">Офсет хэвлэлийн үйлчилгээ</p>
                <div class="social-links">
                    <h5 data-i18n="footer-follow">Биднийг дагаарай</h5>
                    <a href="https://www.facebook.com/productprinting/" target="_blank"><i
                            class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-x-twitter"></i></a>
                </div>
            </div>
            <div class="footer-col" id="footer-contact-info">
                <h4 data-i18n="footer-contact">Холбоо барих</h4>
                <ul>
                    <li><i class="fas fa-phone"></i> 75758575</li>
                    <li><i class="fas fa-phone"></i> 80552222</li>
                    <li><i class="fas fa-phone"></i> 99906069</li>
                    <li><i class="fas fa-phone"></i> 80038228</li>
                    <li><i class="fas fa-envelope"></i> <span data-i18n="footer-email">info@ppm32.mn</span></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4 data-i18n="footer-location">Байршил</h4>
                <ul>
                    <li>
                        <i class="fas fa-map-marker-alt"></i>
                        <span data-i18n="footer-address">Улаанбаатар хот, Сүхбаатар дүүрэг, 12-р хороо, 32-ын тойрог,
                            Номин супермаркетийн зүүн талд, Үйлдвэрийн байр</span>
                    </li>
                </ul>
            </div>
            <div class="footer-col">
                <h4 data-i18n="footer-hours">Ажлын цаг</h4>
                <ul>
                    <li><i class="fas fa-clock"></i> <span data-i18n="footer-mon-fri">Даваа-Баасан: 08:00 - 17:00</span>
                    </li>
                    <li><i class="fas fa-clock"></i> <span data-i18n="footer-sat">Бямба: 10:00 - 15:00</span></li>
                    <li><i class="fas fa-clock"></i> <span data-i18n="footer-sun">Ням: Амрана</span></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p data-i18n="footer-rights">© 2025 Product Printing. Бүх эрх хуулиар хамгаалагдсан.</p>
            <div class="footer-bottom-links">
                <a href="#" data-i18n="footer-privacy">Нууцлалын бодлого</a>
            </div>
        </div>
    </footer>

    <div id="order-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="modal-title">Хүсэлт илгээх</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="contact-form-modal">
                    <div class="form-group">
                        <label data-i18n="modal-name">Нэр *</label>
                        <input type="text" name="contact_name" data-i18n-placeholder="modal-name-placeholder"
                            placeholder="Таны нэр" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="modal-email">Имэйл *</label>
                        <input type="email" name="contact_email" data-i18n-placeholder="modal-email-placeholder"
                            placeholder="example@email.com" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="modal-phone">Утасны дугаар *</label>
                        <input type="tel" name="contact_phone" data-i18n-placeholder="modal-phone-placeholder"
                            placeholder="+976 9999 9999" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="modal-company">Компани</label>
                        <input type="text" name="contact_company" data-i18n-placeholder="modal-company-placeholder"
                            placeholder="Компанийн нэр (сонголттой)">
                    </div>
                    <div class="form-group">
                        <label data-i18n="modal-delivery">Хүргэлтийн арга</label>
                        <select name="delivery_method">
                            <option value="pickup" data-i18n="modal-delivery-pickup">Оффисоос авах</option>
                            <option value="delivery" data-i18n="modal-delivery-delivery">Хүргүүлэх</option>
                        </select>
                    </div>

                    <div class="order-summary-box">
                        <h4 data-i18n="modal-summary-title">Захиалгын дэлгэрэнгүй:</h4>
                        <div class="summary-item">
                            <strong data-i18n="modal-product">Бүтээгдэхүүн:</strong> <span id="summary-product"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-print-type">Хэвлэлийн төрөл:</strong> <span
                                id="summary-print-type"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-format">Хэмжээ:</strong> <span id="summary-format"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-paper">Цаасны төрөл:</strong> <span id="summary-paper"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-coating">Бүрэлт:</strong> <span id="summary-coating"></span>
                        </div>
                        <div class="summary-item" id="summary-pages-item" style="display: none;">
                            <strong data-i18n="form-pages">Нүүрний тоо:</strong> <span id="summary-pages"></span>
                        </div>
                        <div class="summary-item" id="summary-cover-item" style="display: none;">
                            <strong data-i18n="form-cover">Хавтаслалт:</strong> <span id="summary-cover"></span>
                        </div>
                        <div class="summary-item" id="summary-binding-item" style="display: none;">
                            <strong data-i18n="form-binding">Нуруулалт:</strong> <span id="summary-binding"></span>
                        </div>
                        <div class="summary-item" id="summary-folding-item" style="display: none;">
                            <strong data-i18n="form-folding">Нугалаа:</strong> <span id="summary-folding"></span>
                        </div>
                        <div class="summary-item" id="summary-varnish-item" style="display: none;">
                            <strong data-i18n="form-varnish">Лак:</strong> <span id="summary-varnish"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-quantity">Тоо ширхэг:</strong> <span id="summary-quantity"></span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary submit-final-btn" data-i18n="form-send-order">Захиалга
                        илгээх</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Product ID to Translation Key Mapping
        const productKeys = {
            'business_card': 'product-name-card',
            'brochure': 'product-name-brochure',
            'magazine': 'product-name-magazine',
            'book': 'product-name-book',
            'label': 'product-name-label',
            'box': 'product-name-box',
            'bag': 'product-name-bag',
            'invitation': 'product-name-invitation',
            'poster': 'product-name-poster',
            'notebook': 'product-name-notebook',
            'envelope': 'product-name-envelope',
            'invoice': 'product-name-invoice',
            'lamination': 'product-name-lamination'
        };

        function changeImage(src, el) {
            document.getElementById('current-main-img').src = src;
            document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        // Initialize translations and product data
        document.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('preferred-lang') || 'mn';

            // 1. Get Product ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id') || 'business_card'; // Default to card

            // 2. Validate ID and get Name Key
            const nameKey = productKeys[productId] || 'product-name-card';

            // 5. Product Specific Form Configurations (Moved up for use in images)
            const productConfigs = {
                'brochure': {
                    formats: [
                        { key: 'form-format-a5', val: 'A5 (145×210мм)' },
                        { key: 'form-format-a4', val: 'A4 (210×297мм)' },
                        { key: 'form-format-a3', val: 'A3 (420×297мм)' },
                        { key: 'form-format-b5', val: 'B5 (176×250мм)' },
                        { key: 'form-format-b4', val: 'B4 (250×353мм)' },
                        { key: 'form-format-b3', val: 'B3 (353×500мм)' }
                    ],
                    images: [
                        'assets/images/brochure.jpg',
                        'assets/images/brochure_2.jpg',
                        'assets/images/brochure_3.jpg'
                    ],
                    quantities: [300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 4000, 5000, 10000],
                    papers: [
                        { key: 'form-paper-80', val: '80гр (гр)' },
                        { key: 'form-paper-90', val: '90гр (гр)' },
                        { key: 'form-paper-105', val: '105гр (гр)' },
                        { key: 'form-paper-128', val: '128гр (гр)' },
                        { key: 'form-paper-157', val: '157гр (гр)' },
                        { key: 'form-paper-200', val: '200гр (гр)' },
                        { key: 'form-paper-250', val: '250гр (гр)' },
                        { key: 'form-paper-300-coated', val: '300гр шохойтой цаас (гр)' }
                    ],
                    showFoil: false,
                    showSpotUV: false,
                    showPrintType: false,
                    showDeliveryDate: true,
                    showPrepress: true
                },
                'magazine': {
                    formats: [
                        { key: 'form-format-a5', val: 'A5 (мм)' },
                        { key: 'form-format-a4', val: 'A4 (мм)' },
                        { key: 'form-format-b5', val: 'B5 (мм)' },
                        { key: 'form-format-b4', val: 'B4 (мм)' }
                    ],
                    images: [
                        'assets/images/magazine.jpg',
                        'assets/images/magazine_2.jpg',
                        'assets/images/magazine_3.jpg'
                    ],
                    quantities: [300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 4000, 5000, 10000],
                    papers: [
                        { key: 'form-paper-80', val: '80 (гр)' },
                        { key: 'form-paper-90', val: '90 (гр)' },
                        { key: 'form-paper-105', val: '105 (гр)' },
                        { key: 'form-paper-128', val: '128 (гр)' },
                        { key: 'form-paper-157', val: '157 (гр)' }
                    ],
                    pages: [
                        { key: 'form-pages-8', val: '8 нүүр' },
                        { key: 'form-pages-12', val: '12 нүүр' },
                        { key: 'form-pages-16', val: '16 нүүр' }
                    ],
                    covers: [
                        { key: 'form-cover-200', val: '200гр' },
                        { key: 'form-cover-250', val: '250гр' }
                    ],
                    coatings: [
                        { key: 'form-coating-magazine-none', val: 'Хавтас бүрэлтгүй' },
                        { key: 'form-coating-magazine-matte', val: 'Хавтас матт бүрэлттэй' },
                        { key: 'form-coating-magazine-glossy', val: 'Хавтас гялгар бүрэлттэй' }
                    ],
                    showPages: true,
                    showCover: true,
                    showBinding: true,
                    showFoil: true,
                    showSpotUV: true,
                    showPrintType: false,
                    showDeliveryDate: true,
                    showPrepress: true
                },
                'lamination': {
                    formats: [
                        { key: 'form-lamination-size-44', val: '44 см ( 22 микрон, 4000м )' },
                        { key: 'form-lamination-size-54', val: '54 см ( 22 микрон, 4000м )' }
                    ],
                    images: [
                        'assets/images/lamination bopp1.jpg',
                        'assets/images/lamination bopp2.jpg',
                        'assets/images/lamination bopp3.jpg'
                    ],
                    quantities: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                    papers: [], // No paper choice
                    coatings: [
                        { key: 'form-lamination-type-matte', val: 'Матт' },
                        { key: 'form-lamination-type-glossy', val: 'Гялгар' }
                    ],
                    showFolding: false,
                    showVarnish: false,
                    showFoil: false,
                    showSpotUV: false,
                    showPrintType: false,
                    showDeliveryDate: false,
                    showDeliveryInfo: true,
                    showCoating: true,
                    showPrepress: false,
                    customPrice: 390000,
                    labelFormat: 'Хэмжээ',
                    labelCoating: 'Төрөл'
                },
                'default': {
                    formats: [
                        { key: 'form-format-std1', val: 'Стандарт (90×55мм)' },
                        { key: 'form-format-std2', val: 'Стандарт (85×55мм)' }
                    ],
                    quantities: [300, 500, 1000, 5000, 10000],
                    papers: [
                        { key: '', val: '300 (гр)' },
                        { key: '', val: 'Арт 300 (гр)' }
                    ],
                    showFolding: false,
                    showVarnish: false,
                    showFoil: true,
                    showSpotUV: true,
                    showPrintType: true,
                    showPrepress: true
                },
                'book': {
                    formats: [
                        { key: 'form-format-a5', val: 'A5 (мм)' },
                        { key: 'form-format-a4', val: 'A4 (мм)' },
                        { key: 'form-format-b5', val: 'B5 (мм)' },
                        { key: 'form-format-b4', val: 'B4 (мм)' }
                    ],
                    quantities: [300, 500, 1000, 2000, 3000, 4000, 5000],
                    pages: [
                        { key: 'form-pages-80', val: '80 нүүр' },
                        { key: 'form-pages-90', val: '90 нүүр' },
                        { key: 'form-pages-100', val: '100 нүүр' },
                        { key: 'form-pages-110', val: '110 нүүр' },
                        { key: 'form-pages-120', val: '120 нүүр' },
                        { key: 'form-pages-130', val: '130 нүүр' },
                        { key: 'form-pages-140', val: '140 нүүр' },
                        { key: 'form-pages-150', val: '150 нүүр' },
                        { key: 'form-pages-160', val: '160 нүүр' },
                        { key: 'form-pages-170', val: '170 нүүр' },
                        { key: 'form-pages-180', val: '180 нүүр' },
                        { key: 'form-pages-190', val: '190 нүүр' },
                        { key: 'form-pages-200', val: '200 нүүр' },
                        { key: 'form-pages-220', val: '220 нүүр' },
                        { key: 'form-pages-240', val: '240 нүүр' },
                        { key: 'form-pages-260', val: '260 нүүр' },
                        { key: 'form-pages-280', val: '280 нүүр' },
                        { key: 'form-pages-300', val: '300 нүүр' },
                        { key: 'form-pages-400', val: '400 нүүр' },
                        { key: 'form-pages-500', val: '500 нүүр' }
                    ],
                    covers: [
                        { key: 'form-cover-200', val: '200гр' },
                        { key: 'form-cover-250', val: '250гр' },
                        { key: 'form-cover-300', val: '300гр' },
                        { key: 'form-cover-hard', val: 'Хатуу хавтас' }
                    ],
                    papers: [
                        { key: 'form-paper-70', val: '70 (гр)' },
                        { key: 'form-paper-80', val: '80 (гр)' },
                        { key: 'form-paper-90', val: '90 (гр)' },
                        { key: 'form-paper-105', val: '105 (гр)' },
                        { key: 'form-paper-128', val: '128 (гр)' }
                    ],
                    coatings: [
                        { key: 'form-coating-cover-none', val: 'Хавтас бүрэлтгүй' },
                        { key: 'form-coating-cover-matte', val: 'Хавтас матт бүрэлттэй' },
                        { key: 'form-coating-cover-glossy', val: 'Хавтас гялгар бүрэлттэй' },
                        { key: 'form-coating-cover-suede', val: 'Хавтас илгэн бүрэлттэй' }
                    ],
                    showPages: true,
                    showCover: true,
                    showSpotUV: true,
                    labelSpotUV: 'form-checkbox-partial-uv-cover',
                    showPrepress: true,
                    showPrintType: false
                },
                'label': {
                    formats: [
                        { key: 'form-format-a7', val: 'A7 (×мм)' },
                        { key: 'form-format-a6', val: 'A6 (×мм)' },
                        { key: 'form-format-a5', val: 'A5 (×мм)' },
                        { key: 'form-format-b7', val: 'B7 (×мм)' },
                        { key: 'form-format-b6', val: 'B6 (×мм)' },
                        { key: 'form-format-b5', val: 'B5 (×мм)' }
                    ],
                    quantities: [500, 1000, 5000, 10000, 20000, 50000, 100000],
                    papers: [
                        { key: 'form-paper-sticker', val: 'Стикер (гр)' },
                        { key: 'form-paper-80', val: '80 (гр)' },
                        { key: 'form-paper-90', val: '90 (гр)' },
                        { key: 'form-paper-105', val: '105 (гр)' },
                        { key: 'form-paper-128', val: '128 (гр)' },
                        { key: 'form-paper-157', val: '157 (гр)' },
                        { key: 'form-paper-200', val: '200 (гр)' },
                        { key: 'form-paper-250', val: '250 (гр)' },
                        { key: 'form-paper-300-coated', val: '300 (гр)' }
                    ],
                    showVarnish: true,
                    labelFoil: 'form-cliche-required',
                    showFoil: true,
                    showCutSelect: true,
                    showPrepress: true,
                    showPrintType: false
                },
                'box': {
                    formats: [
                        { key: 'form-format-custom', val: 'Өөрийн хэмжээгээр (Тэмдэглэлд бичих)' }
                    ],
                    quantities: [500, 1000, 2000, 3000, 4000, 5000, 10000],
                    papers: [
                        { key: 'form-paper-250', val: '250 (гр)' },
                        { key: 'form-paper-300-coated', val: '300 (гр)' },
                        { key: 'form-paper-350', val: '350 (гр)' }
                    ],
                    showVarnish: true,
                    labelFoil: 'form-cliche-required',
                    showFoil: true,
                    showPrepress: true,
                    showPrintType: false
                },
                'bag': {
                    formats: [
                        { key: 'form-format-a5', val: 'A5 (×мм)' },
                        { key: 'form-format-a4', val: 'A4 (×мм)' },
                        { key: 'form-format-a3', val: 'A3 (×мм)' },
                        { key: 'form-format-b5', val: 'B5 (×мм)' },
                        { key: 'form-format-b4', val: 'B4 (×мм)' },
                        { key: 'form-format-b3', val: 'B3 (×мм)' }
                    ],
                    quantities: [100, 200, 300, 400, 500, 1000, 5000, 10000],
                    papers: [
                        { key: 'form-paper-200', val: '200 (гр)' },
                        { key: 'form-paper-250', val: '250 (гр)' },
                        { key: 'form-paper-300-coated', val: '300 (гр)' }
                    ],
                    showVarnish: true,
                    labelFoil: 'form-cliche-required',
                    showFoil: true,
                    showPrepress: true,
                    showPrintType: false
                },
                'invitation': {
                    formats: [
                        { key: 'form-format-a6', val: 'A6 (×мм)' },
                        { key: 'form-format-a5', val: 'A5 (×мм)' },
                        { key: 'form-format-a4', val: 'A4 (×мм)' },
                        { key: 'form-format-1/3-a4', val: '1/3 - A4 (×мм)' },
                        { key: 'form-format-b6', val: 'B6 (×мм)' },
                        { key: 'form-format-b5', val: 'B5 (×мм)' },
                        { key: 'form-format-b4', val: 'B4 (×мм)' }
                    ],
                    quantities: [100, 150, 200, 250, 300, 350, 400, 450, 500, 600, 700, 800, 900, 1000],
                    papers: [
                        { key: 'form-paper-250', val: '250 (гр)' },
                        { key: 'form-paper-300-coated', val: '300 (гр)' },
                        { key: 'form-paper-209-art', val: 'Арт 209 (гр)' },
                        { key: 'form-paper-250-art', val: 'Арт 250 (гр)' }
                    ],
                    showFolding: true,
                    showPrepress: true,
                    showPrintType: false
                },
                'poster': {
                    formats: [
                        { key: 'form-format-a4', val: 'A4 (×мм)' },
                        { key: 'form-format-a3', val: 'A3 (×мм)' },
                        { key: 'form-format-a2', val: 'A2 (×мм)' },
                        { key: 'form-format-b4', val: 'B4 (×мм)' },
                        { key: 'form-format-b3', val: 'B3 (×мм)' },
                        { key: 'form-format-b2', val: 'B2 (×мм)' }
                    ],
                    quantities: [100, 300, 500, 1000, 3000, 5000, 10000],
                    papers: [
                        { key: 'form-paper-200', val: '200 (гр)' },
                        { key: 'form-paper-250', val: '250 (гр)' },
                        { key: 'form-paper-300-coated', val: '300 (гр)' }
                    ],
                    showSpotUV: true,
                    showCutCheckbox: true,
                    showPrepress: true,
                    showPrintType: false
                },
                'notebook': {
                    formats: [
                        { key: 'form-format-a7', val: 'A7 (×мм)' },
                        { key: 'form-format-a6', val: 'A6 (×мм)' },
                        { key: 'form-format-a5', val: 'A5 (×мм)' },
                        { key: 'form-format-a4', val: 'A4 (×мм)' }
                    ],
                    quantities: [100, 200, 300, 400, 500, 1000, 2000, 3000, 4000, 5000],
                    pages: [
                        { key: 'form-pages-100', val: '100 нүүр' },
                        { key: 'form-pages-120', val: '120 нүүр' },
                        { key: 'form-pages-140', val: '140 нүүр' },
                        { key: 'form-pages-160', val: '160 нүүр' },
                        { key: 'form-pages-180', val: '180 нүүр' },
                        { key: 'form-pages-200', val: '200 нүүр' }
                    ],
                    covers: [
                        { key: 'form-cover-300', val: '300гр' },
                        { key: 'form-cover-hard-cardboard', val: 'Хатуу хавтас ( картон хатуулгатай )' },
                        { key: 'form-cover-leather', val: 'Арьсан хавтас' }
                    ],
                    papers: [
                        { key: 'form-paper-70', val: '70 (гр)' },
                        { key: 'form-paper-80', val: '80 (гр)' },
                        { key: 'form-paper-100', val: '100 (гр)' },
                        { key: 'form-paper-120', val: '120 (гр)' }
                    ],
                    coatings: [], // Scraper didn't list covers? Usually "Coating" for cover exists. I'll leave empty if not specified
                    showPages: true,
                    showCover: true,
                    showBinding: true,
                    // Note: Binding options default to staple/glue. Notebook mentions Ring. I need to update binding options?
                    // "Нуруулалт (Binding): Үдээтэй, Наалттай, Цагаригтай".
                    // Existing options: Staple, Glue. Missing Ring.
                    // I need to add 'bindingOptions' config or just logic to adding 'Ring'.
                    // I will add a `bindings` array to config to override default.
                    bindings: [
                        { key: 'form-binding-staple', val: 'Нуруу үдээтэй' },
                        { key: 'form-binding-glue', val: 'Нуруу наалттай' },
                        { key: 'form-binding-ring', val: 'Цагаригтай' }
                    ],
                    showPrepress: true,
                    showPrintType: false
                },
                'envelope': {
                    formats: [
                        { key: 'form-format-a6', val: 'A6 (×мм)' },
                        { key: 'form-format-a5', val: 'A5 (×мм)' },
                        { key: 'form-format-a4', val: 'A4 (×мм)' },
                        { key: 'form-format-a3', val: 'A3 (×мм)' },
                        { key: 'form-format-b5', val: 'B5 (×мм)' },
                        { key: 'form-format-b4', val: 'B4 (×мм)' },
                        { key: 'form-format-money', val: 'Мөнгөний дугтуй' }
                    ],
                    quantities: [300, 500, 1000, 2000, 3000, 4000, 5000, 10000],
                    papers: [
                        { key: 'form-paper-80', val: '80 (гр)' },
                        { key: 'form-paper-90', val: '90 (гр)' },
                        { key: 'form-paper-100', val: '100 (гр)' },
                        { key: 'form-paper-120', val: '120 (гр)' },
                        { key: 'form-paper-128', val: '128 (гр)' },
                        { key: 'form-paper-157', val: '157 (гр)' },
                        { key: 'form-paper-200', val: '200 (гр)' },
                        { key: 'form-paper-250', val: '250 (гр)' },
                        { key: 'form-paper-300-coated', val: '300 (гр)' }
                    ],
                    showSpotUV: true,
                    labelSpotUV: 'form-decorative-varnish',
                    showPrepress: true,
                    showPrintType: false
                },
                'invoice': {
                    formats: [
                        { key: 'form-format-a6', val: 'A6 (×мм)' },
                        { key: 'form-format-a5', val: 'A5 (×мм)' },
                        { key: 'form-format-a4', val: 'A4 (×мм)' },
                        { key: 'form-format-b6', val: 'B6 (×мм)' },
                        { key: 'form-format-b5', val: 'B5 (×мм)' },
                        { key: 'form-format-1/3-a4', val: '1/3 - A4 (×мм)' }
                    ],
                    quantities: [500, 1000, 3000, 5000, 10000, 20000],
                    papers: [
                        { key: 'form-folding-select', val: 'Сонгох' },
                        { key: 'form-paper-2-copy', val: '2 хувь' },
                        { key: 'form-paper-3-copy', val: '3 хувь' },
                        { key: 'form-paper-4-copy', val: '4 хувь' }
                    ],
                    labelPaper: 'form-paper-selection',
                    showNumbered: true,
                    showTargetPrice: true,
                    showDeliveryInfo: true,
                    deliveryText: 'form-delivery-3-days',
                    showPrepress: true,
                    showPrintType: false,
                    showPrintType: false,
                    showVarnish: false,
                    showFoil: false,
                    showSpotUV: false,
                    showCoating: false
                }
            };

            // 3. Construct Image Paths
            const config = productConfigs[productId] || productConfigs['default'];
            let imgPath1 = config.images ? config.images[0] : `assets/images/${productId}.jpg`;
            let imgPath2 = config.images ? config.images[1] : `assets/images/${productId}_2.jpg`;
            let imgPath3 = config.images ? config.images[2] : `assets/images/${productId}_3.jpg`;

            // 4. Update DOM Elements
            // Breadcrumb
            const breadcrumbSpan = document.querySelector('.breadcrumb span[data-i18n]');
            if (breadcrumbSpan) breadcrumbSpan.setAttribute('data-i18n', nameKey);

            // Form Title
            const formTitle = document.querySelector('.product-form-card h2[data-i18n]');
            if (formTitle) formTitle.setAttribute('data-i18n', nameKey);

            // Images
            const mainImg = document.getElementById('current-main-img');
            mainImg.src = imgPath1;
            mainImg.alt = productId;

            const thumbs = document.querySelectorAll('.thumb img');
            const thumbDivs = document.querySelectorAll('.thumb');

            if (thumbs.length >= 3) {
                thumbs[0].src = imgPath1;
                thumbs[0].parentElement.onclick = function () { changeImage(imgPath1, this); };

                thumbs[1].src = imgPath2;
                thumbs[1].parentElement.onclick = function () { changeImage(imgPath2, this); };

                thumbs[2].src = imgPath3;
                thumbs[2].parentElement.onclick = function () { changeImage(imgPath3, this); };
            }

            // Activate first thumb
            thumbDivs.forEach(t => t.classList.remove('active'));
            if (thumbDivs[0]) thumbDivs[0].classList.add('active');


            // 5. Build Configuration
            if (config) {
                // Update Format options
                if (config.formats) {
                    const formatSelect = document.getElementById('format-select');
                    formatSelect.innerHTML = '';
                    config.formats.forEach(f => {
                        const opt = document.createElement('option');
                        opt.setAttribute('data-i18n', f.key);
                        opt.textContent = f.val;
                        formatSelect.appendChild(opt);
                    });
                }
                // Update Quantity options
                if (config.quantities) {
                    const qtySelect = document.getElementById('quantity-select');
                    qtySelect.innerHTML = '';
                    config.quantities.forEach(q => {
                        const opt = document.createElement('option');
                        opt.textContent = q;
                        qtySelect.appendChild(opt);
                    });
                }
                // Update Paper options
                if (config.papers) {
                    const paperSelect = document.getElementById('paper-select');
                    paperSelect.innerHTML = '';
                    config.papers.forEach(p => {
                        const opt = document.createElement('option');
                        opt.setAttribute('data-i18n', p.key);
                        opt.textContent = p.val;
                        paperSelect.appendChild(opt);
                    });
                }

                // Show/Hide Fields
                document.getElementById('pages-group').style.display = config.showPages ? 'block' : 'none';
                document.getElementById('cover-group').style.display = config.showCover ? 'block' : 'none';
                document.getElementById('binding-group').style.display = config.showBinding ? 'block' : 'none';
                document.getElementById('folding-group').style.display = config.showFolding ? 'block' : 'none';
                document.getElementById('varnish-group').style.display = config.showVarnish ? 'block' : 'none';

                // Logic for Foil (Checkbox)
                const foilGroup = document.getElementById('foil-group');
                foilGroup.style.display = config.showFoil !== false ? 'block' : 'none'; // Default to true if undefined in some contexts? No, default should be careful. Actually 'default' config has showFoil: true.
                if (config.labelFoil) {
                    foilGroup.querySelector('span[data-i18n]').setAttribute('data-i18n', config.labelFoil);
                } else {
                    foilGroup.querySelector('span[data-i18n]').setAttribute('data-i18n', 'form-foil');
                }

                // Logic for Paper Label
                const paperLabel = document.querySelector('#paper-group label');
                if (config.labelPaper) {
                    paperLabel.setAttribute('data-i18n', config.labelPaper);
                } else {
                    paperLabel.setAttribute('data-i18n', 'form-paper');
                }

                // Logic for Spot UV (Checkbox)
                const spotUVGroup = document.getElementById('spot-uv-group');
                spotUVGroup.style.display = config.showSpotUV !== false ? 'block' : 'none';
                if (config.labelSpotUV) {
                    spotUVGroup.querySelector('span[data-i18n]').setAttribute('data-i18n', config.labelSpotUV);
                } else {
                    spotUVGroup.querySelector('span[data-i18n]').setAttribute('data-i18n', 'form-spot-uv');
                }

                document.getElementById('print-type-group').style.display = config.showPrintType !== false ? 'block' : 'none';
                document.getElementById('prepress-group').style.display = config.showPrepress !== false ? 'block' : 'none';
                document.getElementById('coating-group').style.display = config.showCoating !== false ? 'block' : 'none';

                // New Groups
                document.getElementById('cut-select-group').style.display = config.showCutSelect ? 'block' : 'none';
                document.getElementById('cut-checkbox-group').style.display = config.showCutCheckbox ? 'block' : 'none';
                document.getElementById('numbered-group').style.display = config.showNumbered ? 'block' : 'none';
                document.getElementById('target-price-group').style.display = config.showTargetPrice ? 'block' : 'none';

                // Lamination specific visibility
                document.getElementById('paper-group').style.display = config.papers && config.papers.length > 0 ? 'block' : 'none';
                document.getElementById('delivery-date-group').style.display = config.showDeliveryDate !== false ? 'block' : 'none';
                document.getElementById('delivery-info-group').style.display = config.showDeliveryInfo ? 'block' : 'none';

                // Delivery Info Text Update
                if (config.showDeliveryInfo && config.deliveryText) {
                    document.querySelector('.delivery-badge').setAttribute('data-i18n', config.deliveryText);
                } else {
                    document.querySelector('.delivery-badge').setAttribute('data-i18n', 'form-delivery-1-2');
                }

                document.getElementById('lamination-price-display').style.display = config.customPrice ? 'flex' : 'none';

                if (config.labelFormat) {
                    document.querySelector('#format-group label').textContent = config.labelFormat;
                }
                if (config.labelCoating) {
                    document.querySelector('#coating-group label').textContent = config.labelCoating;
                }

                // Update Pages options
                if (config.pages) {
                    const pagesSelect = document.getElementById('pages-select');
                    pagesSelect.innerHTML = '';
                    config.pages.forEach(p => {
                        const opt = document.createElement('option');
                        opt.setAttribute('data-i18n', p.key);
                        opt.textContent = p.val;
                        pagesSelect.appendChild(opt);
                    });
                }

                // Update Cover options
                if (config.covers) {
                    const coverSelect = document.getElementById('cover-select');
                    coverSelect.innerHTML = '';
                    config.covers.forEach(c => {
                        const opt = document.createElement('option');
                        opt.setAttribute('data-i18n', c.key);
                        opt.textContent = c.val;
                        coverSelect.appendChild(opt);
                    });
                }

                // Update Coating options for Lamination
                if (config.coatings) {
                    const coatingSelect = document.querySelector('select[name="coating"]');
                    coatingSelect.innerHTML = '';
                    config.coatings.forEach(c => {
                        const opt = document.createElement('option');
                        opt.setAttribute('data-i18n', c.key);
                        opt.textContent = c.val;
                        coatingSelect.appendChild(opt);
                    });
                }

                // Update Binding options (New)
                if (config.bindings) {
                    const bindingSelect = document.querySelector('select[name="binding"]');
                    bindingSelect.innerHTML = '';
                    // Add Select placeholder
                    const placeholder = document.createElement('option');
                    placeholder.setAttribute('data-i18n', 'form-folding-select');
                    placeholder.textContent = 'Сонгох';
                    bindingSelect.appendChild(placeholder);

                    config.bindings.forEach(b => {
                        const opt = document.createElement('option');
                        opt.setAttribute('data-i18n', b.key);
                        opt.textContent = b.val;
                        bindingSelect.appendChild(opt);
                    });
                }

                // Dynamic Price Calculation for Lamination
                if (config.customPrice) {
                    const qtySelect = document.getElementById('quantity-select');
                    const priceDisplay = document.getElementById('lamination-price');
                    const submitBtn = document.querySelector('.submit-order-btn');

                    // Change button text for inventory
                    submitBtn.setAttribute('data-i18n', 'form-send-order-inventory');
                    if (typeof setLanguage === 'function') {
                        setLanguage(savedLang);
                    }

                    const updatePrice = () => {
                        const qty = parseInt(qtySelect.value) || 0;
                        const total = qty * config.customPrice;
                        priceDisplay.textContent = total.toLocaleString() + '₮';
                    };

                    qtySelect.addEventListener('change', updatePrice);
                    updatePrice(); // Initial call
                }
            }

            // 6. Run Translations
            if (typeof setLanguage === 'function') {
                setLanguage(savedLang);
            }

            // Modal Logic
            const modal = document.getElementById('order-modal');
            const mainForm = document.getElementById('quote-form');
            const closeModal = document.querySelector('.close-modal');
            const modalForm = document.getElementById('contact-form-modal');

            // Open Modal and Populate Data
            mainForm.addEventListener('submit', (e) => {
                e.preventDefault();

                // Get form values
                const formData = new FormData(mainForm);

                // Helper to get text from select option
                const getText = (name) => {
                    const select = mainForm.querySelector(`[name="${name}"]`);
                    if (select && select.tagName === 'SELECT') {
                        return select.options[select.selectedIndex].text;
                    }
                    return formData.get(name);
                };

                // Populate Summary
                // Update product name in summary dynamically based on current title
                document.getElementById('summary-product').textContent = document.querySelector('.product-form-card h2').textContent;

                document.getElementById('summary-print-type').textContent = getText('print_type');
                document.getElementById('summary-format').textContent = getText('format');
                document.getElementById('summary-paper').textContent = getText('paper');
                document.getElementById('summary-coating').textContent = getText('coating');
                document.getElementById('summary-quantity').textContent = getText('quantity');

                // Page Count
                const pages = getText('pages');
                if (pages && document.getElementById('pages-group').style.display !== 'none') {
                    document.getElementById('summary-pages-item').style.display = 'block';
                    document.getElementById('summary-pages').textContent = pages;
                } else {
                    document.getElementById('summary-pages-item').style.display = 'none';
                }

                // Cover
                const cover = getText('cover');
                if (cover && document.getElementById('cover-group').style.display !== 'none') {
                    document.getElementById('summary-cover-item').style.display = 'block';
                    document.getElementById('summary-cover').textContent = cover;
                } else {
                    document.getElementById('summary-cover-item').style.display = 'none';
                }

                // Binding
                const binding = getText('binding');
                if (binding && document.getElementById('binding-group').style.display !== 'none') {
                    document.getElementById('summary-binding-item').style.display = 'block';
                    document.getElementById('summary-binding').textContent = binding;
                } else {
                    document.getElementById('summary-binding-item').style.display = 'none';
                }

                // Additional Brochure Fields
                const folding = getText('folding');
                if (folding && document.getElementById('folding-group').style.display !== 'none') {
                    document.getElementById('summary-folding-item').style.display = 'block';
                    document.getElementById('summary-folding').textContent = folding;
                } else {
                    document.getElementById('summary-folding-item').style.display = 'none';
                }

                const varnish = mainForm.querySelector('[name="varnish"]');
                if (varnish && document.getElementById('varnish-group').style.display !== 'none') {
                    document.getElementById('summary-varnish-item').style.display = 'block';
                    document.getElementById('summary-varnish').textContent = varnish.checked ? (savedLang === 'mn' ? 'Тийм' : 'Yes') : (savedLang === 'mn' ? 'Үгүй' : 'No');
                } else {
                    document.getElementById('summary-varnish-item').style.display = 'none';
                }

                modal.classList.add('active');
            });

            // Close Modal
            closeModal.addEventListener('click', () => {
                modal.classList.remove('active');
            });

            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });

            // Final Submit
            // Final Submit
            modalForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const btn = modalForm.querySelector('.submit-final-btn');
                const originalText = btn.textContent;

                btn.textContent = 'Sending...';
                btn.disabled = true;

                // Gather data
                const contactData = new FormData(modalForm);
                const orderDetails = {
                    Product: document.getElementById('summary-product').textContent,
                    PrintType: document.getElementById('summary-print-type').textContent,
                    Format: document.getElementById('summary-format').textContent,
                    Paper: document.getElementById('summary-paper').textContent,
                    Coating: document.getElementById('summary-coating').textContent,
                    Quantity: document.getElementById('summary-quantity').textContent,
                    Folding: document.getElementById('summary-folding').textContent || 'N/A',
                    Varnish: document.getElementById('summary-varnish').textContent || 'N/A',
                    Notes: document.querySelector('[name="notes"]').value
                };

                // Prepare Data for Google Sheet
                const sheetData = {
                    Product: orderDetails.Product,
                    Name: contactData.get('contact_name'),
                    Phone: contactData.get('contact_phone'),
                    Email: contactData.get('contact_email'),
                    Company: contactData.get('contact_company') || '',
                    Details: `Format: ${orderDetails.Format}, Qty: ${orderDetails.Quantity}, Paper: ${orderDetails.Paper}, Coating: ${orderDetails.Coating}, Notes: ${orderDetails.Notes}`
                };

                // Helper to get text from select option
                const getText = (name) => {
                    const select = mainForm.querySelector(`[name="${name}"]`);
                    if (select && select.tagName === 'SELECT') {
                        return select.options[select.selectedIndex].text;
                    }
                    return formData.get(name);
                };

                // GATHER WHATSAPP DATA (formatted message)
                const PHONE_NUMBER = '97699906069';
                let messageText = `*New Order Received!*\n\n*Customer Info:*\nName: ${contactData.get('contact_name')}\nEmail: ${contactData.get('contact_email')}\nPhone: ${contactData.get('contact_phone')}\nCompany: ${contactData.get('contact_company') || 'N/A'}\nDelivery: ${contactData.get('delivery_method') === 'pickup' ? 'Pick up' : 'Delivery'}\n\n*Order Details:*\nProduct: ${orderDetails.Product}\n`;

                if (config.showPrintType !== false) messageText += `Print Type: ${orderDetails.PrintType}\n`;
                messageText += `Format: ${orderDetails.Format}\n`;
                if (config.showPages) messageText += `Page Count: ${getText('pages')}\n`;
                if (config.showCover) messageText += `Cover: ${getText('cover')}\n`;
                if (config.showBinding) messageText += `Binding: ${getText('binding')}\n`;
                if (config.papers && config.papers.length > 0) messageText += `Paper: ${orderDetails.Paper}\n`;
                if (config.showCoating !== false) messageText += `Coating: ${orderDetails.Coating}\n`;
                if (config.showFolding) messageText += `Folding: ${orderDetails.Folding}\n`;
                if (config.showVarnish) messageText += `Varnish: ${orderDetails.Varnish}\n`;
                if (new FormData(mainForm).get('spot_uv')) messageText += `Spot UV: Yes\n`;
                if (new FormData(mainForm).get('foil')) messageText += `Foil: Yes\n`;
                messageText += `Quantity: ${orderDetails.Quantity}\n`;
                if (config.showPrepress !== false) messageText += `Prepress: ${getText('prepress')}\n`;
                if (config.showDeliveryDate !== false) messageText += `Delivery Date: ${new FormData(mainForm).get('delivery_date')}\n`;
                if (config.showTargetPrice) messageText += `Target Price: ${new FormData(mainForm).get('target_price')}\n`;
                if (new FormData(mainForm).get('notes')) messageText += `\nNotes: ${new FormData(mainForm).get('notes')}\n`;

                // Update sheetData Details with full message for clearer log
                sheetData.Details = messageText;

                // Send to Google Sheet
                const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwvvVfS0avc0BRCH4Z1EdTNtvNBSZ99u8Vyyha3wTHO0g-dyURfd71m6DDBLGZanoj2zA/exec';

                fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Important for Google Apps Script simple triggers
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(sheetData)
                })
                    .then(response => {
                        // Success handling
                        alert('Захиалга амжилттай илгээгдлээ! (Order sent successfully!)');

                        // Optional: Still open WhatsApp as a convenience?
                        // User asked to "collect in google sheet". I will keep WhatsApp as a fallback/secondary contact method but only alert success for now.
                        // Or I can offer the button "Open WhatsApp" in a success message?
                        // For now, I'll Open WhatsApp as well, as it's a "Quote Request" often needing discussion.
                        const whatsappUrl = `https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(messageText.trim())}`;
                        window.open(whatsappUrl, '_blank');

                        modal.classList.remove('active');
                        btn.textContent = originalText;
                        btn.disabled = false;
                        modalForm.reset();
                    })
                    .catch(error => {
                        console.error('Error!', error.message);
                        alert('Something went wrong. Please call us directly.');
                        btn.textContent = originalText;
                        btn.disabled = false;
                    });
            });
        });
    </script>

    <!-- Firebase Dynamic Product Loader -->
    <script type="module">
        import { db } from './firebase-config.js';
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        const source = urlParams.get('source');

        if (source === 'firebase' && productId) {

            async function loadFirebaseProduct() {
                try {
                    const docRef = doc(db, "products", productId);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        const data = docSnap.data();

                        // Update Page Title and Header
                        document.title = `PPM | ${data.name}`;
                        const titleEl = document.querySelector('.product-form-card h2');
                        if (titleEl) {
                            titleEl.textContent = data.name;
                            // Remove i18n attribute to prevent overwrite by translation script
                            titleEl.removeAttribute('data-i18n');
                        }

                        // Update Image
                        const mainImg = document.getElementById('current-main-img');
                        if (mainImg && data.img) {
                            mainImg.src = data.img;
                        }

                        // Update Breadcrumb
                        const breadcrumbSpan = document.querySelector('.breadcrumb span[data-i18n]');
                        if (breadcrumbSpan) {
                            breadcrumbSpan.textContent = data.name;
                            breadcrumbSpan.removeAttribute('data-i18n');
                        }

                        // Optional: If you want to show description, you might need to find a place for it.
                        // Currently product-detail.html doesn't seem to have a dedicated description area in the form, 
                        // but we can inject it if needed. For now, matching the form title and image is sufficient for the Order flow.

                    } else {
                        console.log("No such product!");
                    }
                } catch (error) {
                    console.error("Error getting product:", error);
                }
            }

            loadFirebaseProduct();
        }
    </script>
</body>

</html>