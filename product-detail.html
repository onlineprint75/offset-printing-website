<!DOCTYPE html>
<html lang="mn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPM | Бүтээгдэхүүний дэлгэрэнгүй</title>
    <link rel="icon" type="image/svg+xml" href="assets/images/Logo--ani-02.svg" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>
    <header>
        <div class="container" style="width: 100%; display: flex; justify-content: space-between; align-items: center;">
            <a href="index.html" class="logo">
                <img src="assets/images/logo.png" alt="OFFSET PRINT Logo">
            </a>

            <div class="header-right">
                <div class="mobile-menu-header">
                    <img src="assets/images/logo.png" alt="PPM Logo" class="mobile-logo">
                    <button class="menu-close-btn" id="menu-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mobile-menu-card">
                    <div class="nav-pill">
                        <ul>
                            <li><a href="index.html" data-i18n="nav-home">Нүүр</a></li>
                            <li><a href="about.html" data-i18n="nav-about">Бидний тухай</a></li>
                            <li><a href="inventory.html" data-i18n="nav-inventory">Бараа материал</a></li>
                            <li><a href="contact.html" data-i18n="nav-contact">Холбоо барих</a></li>
                        </ul>
                        <a href="quote.html" class="btn-pill" data-i18n="nav-quote">Үнийн санал авах</a>
                    </div>

                    <div class="menu-divider"></div>

                    <div class="support-info">
                        <span class="phone">7575-8575</span>
                        <span class="label" data-i18n="support-text">Хэрэглэгчийн туслах</span>
                    </div>

                    <div class="lang-switcher" id="lang-switcher">
                        <div class="lang-btn" id="lang-btn">
                            <img src="https://flagcdn.com/w20/mn.png" id="current-lang-flag">
                            <span id="current-lang-name">Монгол</span>
                            <i class="fas fa-chevron-down" style="font-size: 0.7rem; margin-left: 5px;"></i>
                        </div>
                        <div class="lang-dropdown" id="lang-dropdown">
                            <div class="lang-option active" data-lang="mn">
                                <img src="https://flagcdn.com/w20/mn.png"> Монгол
                            </div>
                            <div class="lang-option" data-lang="en">
                                <img src="https://flagcdn.com/w20/gb.png"> English
                            </div>
                            <div class="lang-option" data-lang="zh">
                                <img src="https://flagcdn.com/w20/cn.png"> 中文
                            </div>
                            <div class="lang-option" data-lang="ko">
                                <img src="https://flagcdn.com/w20/kr.png"> 한국어
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div class="menu-overlay" id="menu-overlay"></div>
        <script src="translations.js"></script>
        <script>
            // Mobile Menu Logic
            const menuToggle = document.getElementById('menu-toggle');
            const menuClose = document.getElementById('menu-close');
            const navMenu = document.querySelector('.header-right');
            const menuOverlay = document.getElementById('menu-overlay');

            function openMenu() {
                navMenu.classList.add('active');
                menuOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function closeMenu() {
                navMenu.classList.remove('active');
                menuOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            function toggleMenu() {
                if (navMenu.classList.contains('active')) {
                    closeMenu();
                } else {
                    openMenu();
                }
            }

            menuToggle.addEventListener('click', toggleMenu);
            menuClose.addEventListener('click', closeMenu);
            menuOverlay.addEventListener('click', closeMenu);

            // Swipe to Close Logic (Left to Right)
            let touchStartX = 0;
            let touchEndX = 0;

            document.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });

            document.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: true });

            function handleSwipe() {
                const SWIPE_THRESHOLD = 50;
                const swipeDistance = touchEndX - touchStartX;
                if (navMenu.classList.contains('active') && swipeDistance > SWIPE_THRESHOLD) {
                    closeMenu();
                }
            }


            // Language Switcher Logic
            const langBtn = document.getElementById('lang-btn');
            const langDropdown = document.getElementById('lang-dropdown');
            const langOptions = document.querySelectorAll('.lang-option');

            langBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                langDropdown.classList.toggle('active');
            });

            document.addEventListener('click', () => {
                langDropdown.classList.remove('active');
            });

            langOptions.forEach(opt => {
                opt.addEventListener('click', () => {
                    const lang = opt.getAttribute('data-lang');
                    const flag = opt.querySelector('img').src;
                    const name = opt.textContent.trim();

                    document.getElementById('current-lang-flag').src = flag;
                    document.getElementById('current-lang-name').textContent = name;

                    setLanguage(lang);
                    langDropdown.classList.remove('active');
                });
            });

            // Initialize correct flag/name on load
            window.addEventListener('load', () => {
                const savedLang = localStorage.getItem('preferred-lang') || 'mn';
                const activeOpt = document.querySelector(`.lang-option[data-lang="${savedLang}"]`);
                if (activeOpt) {
                    document.getElementById('current-lang-flag').src = activeOpt.querySelector('img').src;
                    document.getElementById('current-lang-name').textContent = activeOpt.textContent.trim();
                }
            });
        </script>
    </header>

    <main style="padding-top: var(--header-height);">
        <section class="product-detail-section">
            <div class="page-container">
                <nav class="breadcrumb">
                    <a href="index.html" data-i18n="nav-home">Нүүр</a>
                    <span>/</span>
                    <a href="quote.html" data-i18n="nav-quote">Үнийн санал авах</a>
                    <span>/</span>
                    <span data-i18n="product-name-card">Нэрийн хуудас</span>
                </nav>
            </div>
            <div class="page-container product-detail-container">
                <!-- Left: Image Gallery -->
                <div class="product-gallery">
                    <div class="main-image">
                        <img src="assets/images/business_card.jpg" id="current-main-img" alt="Business Card Detail">
                    </div>
                    <div class="thumbnail-grid">
                        <div class="thumb active" onclick="changeImage('assets/images/business_card.jpg', this)">
                            <img src="assets/images/business_card.jpg" alt="Thumbnail 1">
                        </div>
                        <div class="thumb" onclick="changeImage('assets/images/business_card_2.jpg', this)">
                            <img src="assets/images/business_card_2.jpg" alt="Thumbnail 2">
                        </div>
                        <div class="thumb" onclick="changeImage('assets/images/business_card_3.jpg', this)">
                            <img src="assets/images/business_card_3.jpg" alt="Thumbnail 3">
                        </div>
                    </div>
                    <!-- Product Description Section -->
                    <div class="product-description-container"
                        style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee;">
                        <h4 style="margin-bottom: 15px; font-size: 1.1em; color: #333;" data-i18n="product-desc-title">
                            Дэлгэрэнгүй</h4>
                        <p id="product-detail-description" style="color: #666; line-height: 1.6; font-size: 0.95em;">
                            <!-- Description text will be injected here -->
                        </p>
                    </div>
                </div>

                <!-- Right: Product Quote Form -->
                <div class="product-form-card">
                    <h2 data-i18n="product-name-card">Нэрийн хуудас</h2>
                    <form id="quote-form" class="detail-form">
                        <div class="form-group" id="format-group">
                            <label data-i18n="form-format">Хэмжээ</label>
                            <select name="format" id="format-select">
                                <option data-i18n="form-format-std1">Стандарт (90×55мм)</option>
                                <option data-i18n="form-format-std2">Стандарт (85×55мм)</option>
                            </select>
                        </div>

                        <div class="form-group" id="quantity-group">
                            <label data-i18n="form-quantity">Тоо ширхэг</label>
                            <select name="quantity" id="quantity-select">
                                <option>300</option>
                                <option>500</option>
                                <option>1000</option>
                                <option>5000</option>
                                <option>10000</option>
                            </select>
                        </div>



                        <div class="form-group" id="pages-group" style="display: none;">
                            <label data-i18n="form-pages">Нүүрний тоо</label>
                            <select name="pages" id="pages-select">
                                <option data-i18n="form-pages-8">8 нүүр</option>
                                <option data-i18n="form-pages-12">12 нүүр</option>
                                <option data-i18n="form-pages-16">16 нүүр</option>
                            </select>
                        </div>

                        <div class="form-group" id="cover-group" style="display: none;">
                            <label data-i18n="form-cover">Хавтаслалт</label>
                            <select name="cover" id="cover-select">
                                <option data-i18n="form-cover-200">200гр</option>
                                <option data-i18n="form-cover-250">250гр</option>
                            </select>
                        </div>

                        <div class="form-group" id="paper-group">
                            <label data-i18n="form-paper">Цаасны төрөл</label>
                            <select name="paper" id="paper-select">
                                <option>300 (гр)</option>
                                <option>Арт 300 (гр)</option>
                            </select>
                        </div>

                        <div class="form-group" id="prepress-group">
                            <label data-i18n="form-prepress">Эх бэлтгэл байгаа эсэх</label>
                            <select name="prepress">
                                <option data-i18n="form-yes">Тийм</option>
                                <option data-i18n="form-no">Үгүй</option>
                            </select>
                        </div>

                        <div class="form-group" id="coating-group">
                            <label data-i18n="form-coating">Бүрэлтний төрөл</label>
                            <select name="coating">
                                <option data-i18n="form-coating-none">Бүрэлтгүй</option>
                                <option data-i18n="form-coating-matte">Матт бүрэлттэй</option>
                                <option data-i18n="form-coating-glossy">Гялгар бүрэлттэй</option>
                                <option data-i18n="form-coating-suede">Илгэн бүрэлттэй</option>
                            </select>
                        </div>

                        <div class="form-checkbox-group" id="varnish-group" style="display: none;">
                            <label class="checkbox-container">
                                <input type="checkbox" name="varnish">
                                <span class="checkmark"></span>
                                <span data-i18n="form-varnish">Лак бүрэлт хийх</span>
                            </label>
                        </div>

                        <div class="form-group" id="delivery-date-group">
                            <label data-i18n="form-delivery-date">Хүлээн авах хугацаа</label>
                            <input type="date" name="delivery_date" required>
                        </div>

                        <div class="form-group" id="folding-group" style="display: none;">
                            <label data-i18n="form-folding">Нугалааны сонголт</label>
                            <select name="folding">
                                <option data-i18n="form-folding-select">Сонгох</option>
                                <option data-i18n="form-folding-none">Нугалаагүй</option>
                                <option data-i18n="form-folding-1">Нэг нугалаатай</option>
                                <option data-i18n="form-folding-2">2 нугалаатай - Ихэвчлэн 3 нугалбар гэж нэрлэгддэг
                                </option>
                                <option data-i18n="form-folding-3">3 нугалаатай</option>
                                <option data-i18n="form-folding-4">4 нугалаатай</option>
                            </select>
                        </div>

                        <div class="form-group" id="binding-group" style="display: none;">
                            <label data-i18n="form-binding">Нуруулалт</label>
                            <select name="binding">
                                <option data-i18n="form-folding-select">Сонгох</option>
                                <option data-i18n="form-binding-staple">Нуруу үдээтэй</option>
                                <option data-i18n="form-binding-glue">Нуруу наалттай</option>
                            </select>
                        </div>

                        <div class="form-group" id="print-type-group">
                            <label data-i18n="form-print-type">Хэвлэлийн төрөл</label>
                            <select name="print_type">
                                <option data-i18n="form-print-offset">Оффсет хэвлэл</option>
                            </select>
                        </div>

                        <div class="form-checkbox-group" id="spot-uv-group">
                            <label class="checkbox-container">
                                <input type="checkbox" name="spot_uv">
                                <span class="checkmark"></span>
                                <span data-i18n="form-spot-uv">Хэсэгчилсэн лактай ( товгор, гялалзана )</span>
                            </label>
                        </div>

                        <div class="form-checkbox-group" id="foil-group">
                            <label class="checkbox-container">
                                <input type="checkbox" name="foil">
                                <span class="checkmark"></span>
                                <span data-i18n="form-foil">Клиши даралттай ( металл өнгө )</span>
                            </label>
                        </div>

                        <div class="form-group" id="cut-select-group" style="display: none;">
                            <label data-i18n="form-cut">Зүсэлт</label>
                            <select name="cut_select">
                                <option data-i18n="form-cut-select">Зүсэлт хийх</option>
                            </select>
                        </div>

                        <div class="form-checkbox-group" id="cut-checkbox-group" style="display: none;">
                            <label class="checkbox-container">
                                <input type="checkbox" name="cut_checkbox">
                                <span class="checkmark"></span>
                                <span data-i18n="form-cut-select">Зүсэлт хийх</span>
                            </label>
                        </div>

                        <div class="form-checkbox-group" id="numbered-group" style="display: none;">
                            <label class="checkbox-container">
                                <input type="checkbox" name="numbered">
                                <span class="checkmark"></span>
                                <span data-i18n="form-numbered">Номерлогоотой эсэх</span>
                            </label>
                        </div>




                        <div class="form-group" id="delivery-info-group" style="display: none;">
                            <label data-i18n="form-delivery-date">Хүргэлт</label>
                            <div class="delivery-badge" data-i18n="form-delivery-1-2">Ажлын 1-2 хоногт</div>
                        </div>

                        <!-- Lamination Specific Fields (Hidden by default) -->
                        <div id="lamination-fields" style="display: none;">
                            <div class="form-group" id="lamination-finish-group">
                                <label data-i18n="form-lam-kind">Төрөл (Kind)</label>
                                <select name="lamination_finish" id="lamination-finish">
                                    <option value="glossy" data-i18n="form-lam-glossy">Glossy (Гялгар)</option>
                                    <option value="matte" data-i18n="form-lam-matte">Matte (Матт)</option>
                                </select>
                            </div>

                            <div class="form-group" id="lamination-micron-group">
                                <label data-i18n="form-lam-micron">Зузаан (Micron)</label>
                                <select name="lamination_micron" id="lamination-micron">
                                    <option value="20" disabled style="color: #ccc;"
                                        data-i18n="form-lam-micron-20-unavail">20 micron (Дууссан)</option>
                                    <option value="22" selected data-i18n="form-lam-micron-22">22 micron</option>
                                    <option value="24" disabled style="color: #ccc;"
                                        data-i18n="form-lam-micron-24-unavail">24 micron (Дууссан)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label data-i18n="form-lam-width">Өргөн (Width)</label>
                                <select name="lamination_width" id="lamination-width">
                                    <option value="32" disabled style="color: #ccc;"
                                        data-i18n="form-lam-width-32-unavail">32 cm (Дууссан)</option>
                                    <option value="37" disabled style="color: #ccc;"
                                        data-i18n="form-lam-width-37-unavail">37 cm (Дууссан)</option>
                                    <option value="44" selected data-i18n="form-lam-width-44">44 cm</option>
                                    <option value="52" data-i18n="form-lam-width-52">52 cm</option>
                                </select>
                            </div>

                            <div class="form-group" id="lamination-length-group">
                                <label data-i18n="form-lam-length">Ороолтын урт</label>
                                <select name="lamination_length" id="lamination-length">
                                    <option value="3000" disabled style="color: #ccc;"
                                        data-i18n="form-lam-length-3000-unavail">3000 метр (Дууссан)</option>
                                    <option value="4000" selected data-i18n="form-lam-length-4000">4000 метр</option>
                                    <option value="4500" disabled style="color: #ccc;"
                                        data-i18n="form-lam-length-4500-unavail">4500 метр (Дууссан)</option>
                                </select>
                            </div>

                            <!-- Core Size field hidden per user request -->
                            <div class="form-group" style="display: none;">
                                <label>Голч (Core Size)</label>
                                <div class="radio-group">
                                    <label class="radio-container">
                                        <input type="radio" name="lamination_core" value="1" checked>
                                        <span class="radio-checkmark"></span>
                                        1 inch
                                    </label>
                                    <label class="radio-container">
                                        <input type="radio" name="lamination_core" value="3">
                                        <span class="radio-checkmark"></span>
                                        3 inch
                                    </label>
                                </div>
                            </div>

                            <div class="stock-display" id="stock-display"
                                style="margin-bottom: 15px; font-weight: bold; color: var(--primary-color);">
                                <span data-i18n="form-stock">Stock</span>: <span id="current-stock">Checking...</span>
                            </div>

                            <!-- Delivery Toggle -->
                            <div class="form-group">
                                <label data-i18n="form-lam-delivery">Хүргэлт / Авах хэлбэр</label>
                                <div class="radio-group">
                                    <label class="radio-container">
                                        <input type="radio" name="delivery_method_toggle" value="pickup" checked>
                                        <span class="radio-checkmark"></span>
                                        <span data-i18n="form-lam-pickup">Өөрийн биеэр авах (Pickup)</span>
                                    </label>
                                    <label class="radio-container">
                                        <input type="radio" name="delivery_method_toggle" value="delivery">
                                        <span class="radio-checkmark"></span>
                                        <span data-i18n="form-lam-delivery-opt">Хүргэлтээр авах</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Conditional Delivery Fields -->
                            <div id="delivery-details"
                                style="display: none; padding: 15px; background: #f9f9f9; border-radius: 8px; margin-bottom: 15px;">
                                <div class="form-group">
                                    <label data-i18n="form-delivery-select-district">Дүүрэг сонгох</label>
                                    <select name="delivery_district">
                                        <option value="SBD">Сүхбаатар</option>
                                        <option value="BZD">Баянзүрх</option>
                                        <option value="BGD">Баянгол</option>
                                        <option value="HUD">Хан-Уул</option>
                                        <option value="SHD">Сонгинохайрхан</option>
                                        <option value="CHD">Чингэлтэй</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label data-i18n="form-delivery-address">Хүлээн авах хаяг</label>
                                    <textarea name="delivery_address" rows="2"
                                        data-i18n-placeholder="form-delivery-address-placeholder"
                                        placeholder="Хороо, байр, орц..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label data-i18n="form-delivery-phone">Утасны дугаар</label>
                                    <input type="tel" name="recipient_phone" placeholder="8888-8888">
                                </div>
                            </div>

                            <!-- VAT Toggle -->
                            <div class="form-checkbox-group">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="vat-toggle" name="vat_enabled">
                                    <span class="checkmark"></span>
                                    <span data-i18n="form-lam-vat">e-Barimt авах (VAT Receipt)</span>
                                </label>
                            </div>

                            <!-- Conditional VAT Fields -->
                            <div id="vat-details"
                                style="display: none; padding: 15px; background: #f9f9f9; border-radius: 8px; margin-bottom: 15px;">
                                <div class="form-group">
                                    <label data-i18n="form-vat-type">Төрөл</label>
                                    <div class="radio-group">
                                        <label class="radio-container">
                                            <input type="radio" name="vat_type" value="organization" checked>
                                            <span class="radio-checkmark"></span>
                                            <span data-i18n="form-vat-organization">Байгууллага</span>
                                        </label>
                                        <label class="radio-container">
                                            <input type="radio" name="vat_type" value="individual">
                                            <span class="radio-checkmark"></span>
                                            <span data-i18n="form-vat-individual">Хувь хүн</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label data-i18n="form-vat-tin">Регистрийн дугаар (TIN)</label>
                                    <input type="text" name="vat_tin" placeholder="1234567890">
                                </div>
                            </div>
                        </div>


                        <!-- Notes Group (Final Position) -->
                        <div class="form-group" id="notes-group">
                            <label data-i18n="form-notes">Тэмдэглэл</label>
                            <textarea name="notes" rows="3" data-i18n-placeholder="form-notes-placeholder"
                                placeholder="Тухайлбар, онцгой хүсэлт..."></textarea>
                        </div>

                        <div class="quote-display" id="lamination-price-display" style="display: none;">
                            <div class="label" data-i18n="form-quote-amount">Үнийн дүн (₮)</div>
                            <div class="amount" id="lamination-price">0₮</div>
                        </div>

                        <div class="form-group" id="target-price-group" style="display: none;">
                            <label data-i18n="form-target-price">Үнийн санал (₮)</label>
                            <input type="text" name="target_price" data-i18n-placeholder="form-target-price-placeholder"
                                placeholder="Таны санал болгож буй үнэ (сонголттой)">
                            <small data-i18n="form-target-price-hint"
                                style="display: block; margin-top: 5px; color: #666; font-size: 0.85em;">Таны санал
                                болгож буй үнэ. Хоосон орхиж болно.</small>
                        </div>

                        <button type="submit" class="btn btn-primary submit-order-btn"
                            data-i18n="form-send-order">Хүсэлт
                            илгээх</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <!-- Footer content integrated from index.html -->
        <div class="footer-content">
            <div class="footer-col">
                <h4 data-i18n="footer-company">Продакт Принтинг Монголиа ХХК</h4>
                <p data-i18n="footer-services">Офсет хэвлэлийн үйлчилгээ</p>
                <div class="social-links">
                    <h5 data-i18n="footer-follow">Биднийг дагаарай</h5>
                    <a href="https://www.facebook.com/productprinting/" target="_blank"><i
                            class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-x-twitter"></i></a>
                </div>
            </div>
            <div class="footer-col" id="footer-contact-info">
                <h4 data-i18n="footer-contact">Холбоо барих</h4>
                <ul>
                    <li><i class="fas fa-phone"></i> 75758575</li>
                    <li><i class="fas fa-phone"></i> 80552222</li>
                    <li><i class="fas fa-phone"></i> 99906069</li>
                    <li><i class="fas fa-phone"></i> 80038228</li>
                    <li><i class="fas fa-envelope"></i> <span data-i18n="footer-email">info@ppm32.mn</span></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4 data-i18n="footer-location">Байршил</h4>
                <ul>
                    <li>
                        <i class="fas fa-map-marker-alt"></i>
                        <span data-i18n="footer-address">Улаанбаатар хот, Сүхбаатар дүүрэг, 12-р хороо, 32-ын тойрог,
                            Номин супермаркетийн зүүн талд, Үйлдвэрийн байр</span>
                    </li>
                </ul>
            </div>
            <div class="footer-col">
                <h4 data-i18n="footer-hours">Ажлын цаг</h4>
                <ul>
                    <li><i class="fas fa-clock"></i> <span data-i18n="footer-mon-fri">Даваа-Баасан: 08:00 - 17:00</span>
                    </li>
                    <li><i class="fas fa-clock"></i> <span data-i18n="footer-sat">Бямба: 10:00 - 15:00</span></li>
                    <li><i class="fas fa-clock"></i> <span data-i18n="footer-sun">Ням: Амрана</span></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p data-i18n="footer-rights">© 2025 Product Printing. Бүх эрх хуулиар хамгаалагдсан.</p>
            <div class="footer-bottom-links">
                <a href="#" data-i18n="footer-privacy">Нууцлалын бодлого</a>
            </div>
        </div>
    </footer>

    <div id="order-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="modal-title">Хүсэлт илгээх</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="contact-form-modal">
                    <div class="form-group">
                        <label data-i18n="modal-name">Нэр *</label>
                        <input type="text" name="contact_name" data-i18n-placeholder="modal-name-placeholder"
                            placeholder="Таны нэр" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="modal-email">Имэйл *</label>
                        <input type="email" name="contact_email" data-i18n-placeholder="modal-email-placeholder"
                            placeholder="example@email.com" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="modal-phone">Утасны дугаар *</label>
                        <input type="tel" name="contact_phone" data-i18n-placeholder="modal-phone-placeholder"
                            placeholder="+976 9999 9999" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="modal-company">Компани</label>
                        <input type="text" name="contact_company" data-i18n-placeholder="modal-company-placeholder"
                            placeholder="Компанийн нэр (сонголттой)">
                    </div>
                    <div class="form-group">
                        <label data-i18n="modal-delivery">Хүргэлтийн арга</label>
                        <select name="delivery_method">
                            <option value="pickup" data-i18n="modal-delivery-pickup">Оффисоос авах</option>
                            <option value="delivery" data-i18n="modal-delivery-delivery">Хүргүүлэх</option>
                        </select>
                    </div>

                    <div class="order-summary-box">
                        <h4 data-i18n="modal-summary-title">Захиалгын дэлгэрэнгүй:</h4>
                        <div class="summary-item">
                            <strong data-i18n="modal-product">Бүтээгдэхүүн:</strong> <span id="summary-product"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-print-type">Хэвлэлийн төрөл:</strong> <span
                                id="summary-print-type"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-format">Хэмжээ:</strong> <span id="summary-format"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-paper">Цаасны төрөл:</strong> <span id="summary-paper"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-coating">Бүрэлт:</strong> <span id="summary-coating"></span>
                        </div>
                        <div class="summary-item" id="summary-pages-item" style="display: none;">
                            <strong data-i18n="form-pages">Нүүрний тоо:</strong> <span id="summary-pages"></span>
                        </div>
                        <div class="summary-item" id="summary-cover-item" style="display: none;">
                            <strong data-i18n="form-cover">Хавтаслалт:</strong> <span id="summary-cover"></span>
                        </div>
                        <div class="summary-item" id="summary-binding-item" style="display: none;">
                            <strong data-i18n="form-binding">Нуруулалт:</strong> <span id="summary-binding"></span>
                        </div>
                        <div class="summary-item" id="summary-folding-item" style="display: none;">
                            <strong data-i18n="form-folding">Нугалаа:</strong> <span id="summary-folding"></span>
                        </div>
                        <div class="summary-item" id="summary-varnish-item" style="display: none;">
                            <strong data-i18n="form-varnish">Лак:</strong> <span id="summary-varnish"></span>
                        </div>
                        <div class="summary-item">
                            <strong data-i18n="modal-quantity">Тоо ширхэг:</strong> <span id="summary-quantity"></span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary submit-final-btn" data-i18n="form-send-order">Захиалга
                        илгээх</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 3. Construct Image Paths
        // Legacy logic removed. All data now comes from products-data.js.

        // 4. Update DOM Elements
        // Breadcrumb and Form Title will be updated by the Static Product Loader script below.

        // Images
        // Initial image setup will be handled by Static Product Loader.

        // 5. Build Configuration
        // Configuration logic moved to Static Product Loader.
        let config = {}; // Global config for form submission handlers

        // 6. Run Translations
        // Moved to main loader script to ensure savedLang is defined via localStorage checking
        // if (typeof setLanguage === 'function') {
        //    const savedLang = localStorage.getItem('preferred-lang') || 'mn';
        //    setLanguage(savedLang);
        // }

        // Modal Logic

        const modal = document.getElementById('order-modal');
        const mainForm = document.getElementById('quote-form');
        const closeModal = document.querySelector('.close-modal');
        const modalForm = document.getElementById('contact-form-modal');

        // Open Modal and Populate Data
        mainForm.addEventListener('submit', (e) => {
            e.preventDefault();

            // Get form values
            const formData = new FormData(mainForm);

            // Helper to get text from select option
            const getText = (name) => {
                const select = mainForm.querySelector(`[name="${name}"]`);
                if (select && select.tagName === 'SELECT') {
                    return select.options[select.selectedIndex].text;
                }
                return formData.get(name);
            };

            // Populate Summary
            // Update product name in summary dynamically based on current title
            document.getElementById('summary-product').textContent = document.querySelector('.product-form-card h2').textContent;

            document.getElementById('summary-print-type').textContent = getText('print_type');
            document.getElementById('summary-format').textContent = getText('format');
            document.getElementById('summary-paper').textContent = getText('paper');
            document.getElementById('summary-coating').textContent = getText('coating');
            document.getElementById('summary-quantity').textContent = getText('quantity');

            // Page Count
            const pages = getText('pages');
            if (pages && document.getElementById('pages-group').style.display !== 'none') {
                document.getElementById('summary-pages-item').style.display = 'block';
                document.getElementById('summary-pages').textContent = pages;
            } else {
                document.getElementById('summary-pages-item').style.display = 'none';
            }

            // Cover
            const cover = getText('cover');
            if (cover && document.getElementById('cover-group').style.display !== 'none') {
                document.getElementById('summary-cover-item').style.display = 'block';
                document.getElementById('summary-cover').textContent = cover;
            } else {
                document.getElementById('summary-cover-item').style.display = 'none';
            }

            // Binding
            const binding = getText('binding');
            if (binding && document.getElementById('binding-group').style.display !== 'none') {
                document.getElementById('summary-binding-item').style.display = 'block';
                document.getElementById('summary-binding').textContent = binding;
            } else {
                document.getElementById('summary-binding-item').style.display = 'none';
            }

            // Additional Brochure Fields
            const folding = getText('folding');
            if (folding && document.getElementById('folding-group').style.display !== 'none') {
                document.getElementById('summary-folding-item').style.display = 'block';
                document.getElementById('summary-folding').textContent = folding;
            } else {
                document.getElementById('summary-folding-item').style.display = 'none';
            }

            const varnish = mainForm.querySelector('[name="varnish"]');
            if (varnish && document.getElementById('varnish-group').style.display !== 'none') {
                document.getElementById('summary-varnish-item').style.display = 'block';
                const currentLang = localStorage.getItem('preferred-lang') || 'mn';
                document.getElementById('summary-varnish').textContent = varnish.checked ? (currentLang === 'mn' ? 'Тийм' : 'Yes') : (currentLang === 'mn' ? 'Үгүй' : 'No');
            } else {
                document.getElementById('summary-varnish-item').style.display = 'none';
            }

            modal.classList.add('active');
        });

        // Close Modal
        closeModal.addEventListener('click', () => {
            modal.classList.remove('active');
        });

        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });

        // Final Submit
        modalForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = modalForm.querySelector('.submit-final-btn');
            const originalText = btn.textContent;

            // Re-capture main form data in this scope
            const mainFormData = new FormData(mainForm);

            btn.textContent = 'Sending...';
            btn.disabled = true;

            // Gather data
            const contactData = new FormData(modalForm);
            const orderDetails = {
                Product: document.getElementById('summary-product').textContent,
                PrintType: document.getElementById('summary-print-type').textContent,
                Format: document.getElementById('summary-format').textContent,
                Paper: document.getElementById('summary-paper').textContent,
                Coating: document.getElementById('summary-coating').textContent,
                Quantity: document.getElementById('summary-quantity').textContent,
                Folding: document.getElementById('summary-folding').textContent || 'N/A',
                Varnish: document.getElementById('summary-varnish').textContent || 'N/A',
                Notes: document.querySelector('[name="notes"]').value
            };

            // Prepare Data for Google Sheet
            const sheetData = {
                Product: orderDetails.Product,
                Name: contactData.get('contact_name'),
                Phone: contactData.get('contact_phone'),
                Email: contactData.get('contact_email'),
                Company: contactData.get('contact_company') || '',
                Details: `Format: ${orderDetails.Format}, Qty: ${orderDetails.Quantity}, Paper: ${orderDetails.Paper}, Coating: ${orderDetails.Coating}, Notes: ${orderDetails.Notes}`
            };

            // Helper to get text from select option
            const getText = (name) => {
                const select = mainForm.querySelector(`[name="${name}"]`);
                if (select && select.tagName === 'SELECT') {
                    return select.options[select.selectedIndex].text;
                }
                return mainFormData.get(name);
            };

            // GATHER WHATSAPP DATA (formatted message)
            const PHONE_NUMBER = '97699906069';
            let messageText = `*New Order Received!*\n\n*Customer Info:*\nName: ${contactData.get('contact_name')}\nEmail: ${contactData.get('contact_email')}\nPhone: ${contactData.get('contact_phone')}\nCompany: ${contactData.get('contact_company') || 'N/A'}\nDelivery: ${contactData.get('delivery_method') === 'pickup' ? 'Pick up' : 'Delivery'}\n\n*Order Details:*\nProduct: ${orderDetails.Product}\n`;

            if (config.showPrintType !== false) messageText += `Print Type: ${orderDetails.PrintType}\n`;
            messageText += `Format: ${orderDetails.Format}\n`;
            if (config.showPages) messageText += `Page Count: ${getText('pages')}\n`;
            if (config.showCover) messageText += `Cover: ${getText('cover')}\n`;
            if (config.showBinding) messageText += `Binding: ${getText('binding')}\n`;
            if (config.papers && config.papers.length > 0) messageText += `Paper: ${orderDetails.Paper}\n`;
            if (config.showCoating !== false) messageText += `Coating: ${orderDetails.Coating}\n`;
            if (config.showFolding) messageText += `Folding: ${orderDetails.Folding}\n`;
            if (config.showVarnish) messageText += `Varnish: ${orderDetails.Varnish}\n`;
            if (new FormData(mainForm).get('spot_uv')) messageText += `Spot UV: Yes\n`;
            if (new FormData(mainForm).get('foil')) messageText += `Foil: Yes\n`;
            messageText += `Quantity: ${orderDetails.Quantity}\n`;

            // Lamination Specifics
            if (config.showLaminationFields) {
                messageText += `--- Lamination Details ---\n`;
                messageText += `Finish: ${new FormData(mainForm).get('lamination_finish')}\n`;
                messageText += `Micron: ${new FormData(mainForm).get('lamination_micron')}\n`;
                messageText += `Width: ${new FormData(mainForm).get('lamination_width')} cm\n`;
                messageText += `Core: ${new FormData(mainForm).get('lamination_core')} inch\n`;

                const deliveryMethod = new FormData(mainForm).get('delivery_method_toggle');
                messageText += `Delivery Method: ${deliveryMethod}\n`;
                if (deliveryMethod === 'delivery') {
                    messageText += `District: ${new FormData(mainForm).get('delivery_district')}\n`;
                    messageText += `Address: ${new FormData(mainForm).get('delivery_address')}\n`;
                    messageText += `Recipient Phone: ${new FormData(mainForm).get('recipient_phone')}\n`;
                }

                if (new FormData(mainForm).get('vat_enabled')) {
                    messageText += `VAT Type: ${new FormData(mainForm).get('vat_type')}\n`;
                    messageText += `VAT TIN: ${new FormData(mainForm).get('vat_tin')}\n`;
                }
            }

            if (config.showPrepress !== false) messageText += `Prepress: ${getText('prepress')}\n`;
            if (config.showDeliveryDate !== false) messageText += `Delivery Date: ${new FormData(mainForm).get('delivery_date')}\n`;
            if (config.showTargetPrice) messageText += `Target Price: ${new FormData(mainForm).get('target_price')}\n`;
            if (new FormData(mainForm).get('notes')) messageText += `\nNotes: ${new FormData(mainForm).get('notes')}\n`;

            // Update sheetData Details with full message for clearer log
            sheetData.Details = messageText;

            // Send to Google Sheet
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwvvVfS0avc0BRCH4Z1EdTNtvNBSZ99u8Vyyha3wTHO0g-dyURfd71m6DDBLGZanoj2zA/exec';

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // Important for Google Apps Script simple triggers
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(sheetData)
            })
                .then(response => {
                    // Success handling
                    // Removed WhatsApp redirect as per user request.

                    const modalBody = modal.querySelector('.modal-body');

                    // Hide form instead of replacing HTML to preserve listeners
                    modalForm.style.display = 'none';

                    // Create Success Message Element
                    const successDiv = document.createElement('div');
                    successDiv.id = 'success-message-container';
                    successDiv.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px;">
                            <i class="fas fa-check-circle" style="font-size: 3rem; color: #28a745; margin-bottom: 20px;"></i>
                            <h3 style="color: #333; margin-bottom: 15px;">Таны хүсэлтийг хүлээн авлаа</h3>
                            <p style="color: #666; font-size: 1.1rem;">Танд тун удахгүй хариу өгөх болно.</p>
                        </div>
                    `;
                    modalBody.appendChild(successDiv);

                    setTimeout(() => {
                        modal.classList.remove('active');
                        // Restore form after transition
                        setTimeout(() => {
                            if (document.getElementById('success-message-container')) {
                                document.getElementById('success-message-container').remove();
                            }
                            modalForm.style.display = 'block';
                            modalForm.reset();
                            btn.textContent = originalText;
                            btn.disabled = false;
                        }, 300); // wait for fade out
                    }, 5000);
                })

                .catch(error => {
                    console.error('Error!', error.message);
                    alert('Something went wrong. Please call us directly.');
                    btn.textContent = originalText;
                    btn.disabled = false;
                });
        });


        // StockManager moved or kept here?
        // It is fine here as long as the script doesn't crash above.
        // --- Modular Stock Manager ---
        class StockManager {
            constructor() {
                // Mock Stock Data (Can be easily swapped with Firestore)
                this.stock = {
                    'default': 20,
                    'lamination_32_20_glossy': 15,
                    'lamination_32_25_glossy': 10,
                    'lamination_32_30_glossy': 5,
                    'lamination_32_20_matte': 12,
                    'lamination_32_25_matte': 8,
                    'lamination_32_30_matte': 0, // Out of stock
                    'lamination_44_20_glossy': 15,
                    'lamination_52_20_glossy': 20
                };
            }

            async getStock(productId, specs) {
                // Simulate API call with delay
                return new Promise(resolve => {
                    setTimeout(() => {
                        // Safe check for properties
                        if (!specs) { resolve(0); return; }

                        const key = `lamination_${specs.width}_${specs.micron}_${specs.finish}`;
                        if (this.stock.hasOwnProperty(key)) {
                            resolve(this.stock[key]);
                        } else {
                            resolve(Math.floor(Math.random() * 20));
                        }
                    }, 400);
                });
            }
        }

        // --- Lamination Specific Logic Initialization ---
        function initLaminationLogic(lang, productData) {
            const stockManager = new StockManager();
            const finishSelect = document.getElementById('lamination-finish');
            const micronSelect = document.getElementById('lamination-micron');

            const widthSelect = document.getElementById('lamination-width');
            const lengthSelect = document.getElementById('lamination-length');
            const coreRadios = document.querySelectorAll('input[name="lamination_core"]');
            const stockDisplay = document.getElementById('current-stock');

            // FIX: Ensure we have a quantity selector
            let qtySelect = document.getElementById('quantity-select');

            const priceDisplay = document.getElementById('lamination-price');
            const priceDisplayContainer = document.getElementById('lamination-price-display');
            const submitBtn = document.querySelector('.submit-order-btn');

            // Set Button Text explicitly for Inventory/Order
            if (submitBtn) {
                const lang = localStorage.getItem('preferred-lang') || 'mn';
                const orderText = (typeof getTranslation === 'function' && getTranslation('form-order-btn')) || 'Захиалах';
                submitBtn.textContent = orderText;
                submitBtn.setAttribute('data-i18n', 'form-order-btn');
            }

            // Deliver & VAT Toggles
            const deliveryToggle = document.querySelectorAll('input[name="delivery_method_toggle"]');
            const deliveryDetails = document.getElementById('delivery-details');

            const vatToggle = document.getElementById('vat-toggle');
            const vatDetails = document.getElementById('vat-details');

            // 1. Toggle Logic
            deliveryToggle.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'delivery') {
                        deliveryDetails.style.display = 'block';
                    } else {
                        deliveryDetails.style.display = 'none';
                    }
                });
            });

            if (vatToggle) {
                vatToggle.addEventListener('change', (e) => {
                    vatDetails.style.display = e.target.checked ? 'block' : 'none';
                });
            }

            // 2. Price & Stock Interaction
            const updateState = async () => {
                // FORCE SHOW PRICE DISPLAY
                if (priceDisplayContainer) {
                    priceDisplayContainer.style.display = 'flex';
                    priceDisplayContainer.style.visibility = 'visible';
                }

                const finish = finishSelect ? finishSelect.value : 'glossy';
                const micron = micronSelect ? parseInt(micronSelect.value) || 20 : 20;
                const width = widthSelect ? parseInt(widthSelect.value) || 32 : 32;

                // --- Price Calculation (Moved Before Stock Check) ---
                let total = 0;
                const qty = qtySelect ? (parseInt(qtySelect.value) || 1) : 1;

                if (productData && productData.unitPrice) {
                    // Simple Unit Price Calculation (e.g. Sticker)
                    total = productData.unitPrice * qty;
                } else {
                    // Lamination BOPP Logic
                    const tempLen = lengthSelect ? (parseInt(lengthSelect.value) || 4000) : 4000;

                    // Base Unit Price for 44cm/4000m
                    let baseRefPrice = 400000;

                    const widthRatio = width / 44;
                    const lengthRatio = tempLen / 4000;

                    let unitPrice = baseRefPrice * widthRatio * lengthRatio;
                    unitPrice = Math.round(unitPrice / 100) * 100;

                    total = unitPrice * qty;
                }

                if (priceDisplay) {
                    priceDisplay.textContent = total.toLocaleString() + '₮';
                }

                // --- Stock Check ---
                if (stockDisplay) {
                    stockDisplay.textContent = 'Checking...';
                    stockDisplay.style.color = '#e67e22';
                }

                try {
                    const stock = await stockManager.getStock('lamination', { width, micron, finish });
                    if (stockDisplay) {
                        stockDisplay.textContent = stock;
                        stockDisplay.style.color = stock > 0 ? '#27ae60' : '#c0392b';
                    }
                } catch (e) {
                    console.error("Stock check failed", e);
                    if (stockDisplay) stockDisplay.textContent = "Error";
                }
            };

            // Re-attach listeners just in case
            if (finishSelect) {
                finishSelect.onclick = updateState;
                finishSelect.onchange = updateState;
            }

            if (micronSelect) micronSelect.onchange = updateState;
            if (widthSelect) widthSelect.onchange = updateState;
            if (lengthSelect) lengthSelect.onchange = updateState;
            if (qtySelect) qtySelect.onchange = updateState;

            // Initial run
            updateState();
        }
    </script>

    <!-- Static Product Loader (Replaced Firebase) -->
    <script src="products-data.js"></script>
    <script>
        // Wait for DOM and other scripts to be ready
        document.addEventListener('DOMContentLoaded', function () {
            // Use setTimeout to ensure this runs AFTER the main product config script
            setTimeout(function () {
                // Helper function to get translation by key
                function getTranslation(key) {
                    const lang = localStorage.getItem('preferred-lang') || 'mn';
                    if (typeof translations !== 'undefined' && translations[lang] && translations[lang][key]) {
                        return translations[lang][key];
                    }
                    return null;
                }
                const urlParams = new URLSearchParams(window.location.search);
                const productId = urlParams.get('id');

                // Check if this is a static product ID (not a predefined one like business_card)
                const staticProduct = typeof getProductById === 'function' ? getProductById(productId) : null;

                if (staticProduct) {
                    const data = staticProduct;

                    // Detect Lamination Product by flag or name
                    if (data.isLamination || (data.name && data.name.toLowerCase().includes('lamination'))) {
                        const lamFields = document.getElementById('lamination-fields');
                        if (lamFields) lamFields.style.display = 'block';

                        /* STRICTLY HIDE GENERIC FIELDS */
                        const genericGroups = ["format-group", "paper-group", "print-type-group", "coating-group", "pages-group", "cover-group", "binding-group", "folding-group", "varnish-group", "prepress-group", "cut-select-group", "cut-checkbox-group", "numbered-group", "target-price-group", "foil-group", "spot-uv-group", "delivery-date-group", "delivery-info-group"];
                        genericGroups.forEach(id => {
                            const el = document.getElementById(id);
                            if (el) el.style.display = "none";
                        });

                        // Apply custom form config if available
                        if (data.formConfig) {
                            // Assign to GLOBAL config for use in submit handler
                            config = data.formConfig;
                            const cfg = config;       // keep local alias for readability below

                            // Custom Quantities
                            if (cfg.quantities) {
                                const qtySelect = document.getElementById('quantity-select');
                                if (qtySelect) {
                                    qtySelect.innerHTML = '';
                                    cfg.quantities.forEach(q => {
                                        const opt = document.createElement('option');
                                        opt.value = q;
                                        opt.textContent = q;
                                        qtySelect.appendChild(opt);
                                    });
                                }
                            }

                            // Custom Roll Length Visibility
                            if (cfg.showRollLength === false) {
                                const rollLengthGroup = document.getElementById('lamination-length-group');
                                if (rollLengthGroup) rollLengthGroup.style.display = 'none';
                            }

                            // Custom Finish Options (Kind / Төрөл)
                            if (cfg.finishOptions) {
                                const finishSelect = document.getElementById('lamination-finish');
                                const finishGroup = document.getElementById('lamination-finish-group');

                                if (cfg.finishOptions.length === 0 && finishGroup) {
                                    finishGroup.style.display = 'none';
                                } else if (finishSelect) {
                                    if (finishGroup) finishGroup.style.display = 'block';
                                    finishSelect.innerHTML = '';
                                    cfg.finishOptions.forEach(opt => {
                                        const option = document.createElement('option');
                                        option.value = opt.value;
                                        // Use i18nKey if available, otherwise fallback to label
                                        option.textContent = opt.i18nKey ? (getTranslation(opt.i18nKey) || opt.label || opt.value) : (opt.label || opt.value);
                                        option.setAttribute('data-i18n', opt.i18nKey || '');
                                        if (!opt.enabled) {
                                            option.disabled = true;
                                            option.style.color = '#ccc';
                                        }
                                        finishSelect.appendChild(option);
                                    });
                                }
                            }

                            // Custom Thickness Options (replaces Micron)
                            if (cfg.thicknessOptions) {
                                const micronSelect = document.getElementById('lamination-micron');
                                const micronGroup = document.getElementById('lamination-micron-group');
                                const micronLabel = micronSelect ? micronSelect.parentElement.querySelector('label') : null;

                                if (cfg.thicknessOptions.length === 0 && micronGroup) {
                                    micronGroup.style.display = 'none';
                                } else {
                                    if (micronGroup) micronGroup.style.display = 'block';
                                    if (micronLabel && cfg.thicknessLabelKey) {
                                        micronLabel.textContent = getTranslation(cfg.thicknessLabelKey) || cfg.thicknessLabel || 'Thickness';
                                        micronLabel.setAttribute('data-i18n', cfg.thicknessLabelKey);
                                    } else if (micronLabel && cfg.thicknessLabel) {
                                        micronLabel.textContent = cfg.thicknessLabel;
                                    }
                                    if (micronSelect) {
                                        micronSelect.innerHTML = '';
                                        cfg.thicknessOptions.forEach(opt => {
                                            const option = document.createElement('option');
                                            option.value = opt.value;
                                            option.textContent = opt.i18nKey ? (getTranslation(opt.i18nKey) || opt.label || opt.value) : (opt.label || opt.value);
                                            option.setAttribute('data-i18n', opt.i18nKey || '');
                                            if (!opt.enabled) {
                                                option.disabled = true;
                                                option.style.color = '#ccc';
                                            }
                                            if (opt.selected) option.selected = true;
                                            micronSelect.appendChild(option);
                                        });
                                    }
                                }
                            }

                            // Custom Size Options (replaces Width)
                            if (cfg.sizeOptions) {
                                const widthSelect = document.getElementById('lamination-width');
                                const widthLabel = widthSelect ? widthSelect.parentElement.querySelector('label') : null;
                                if (widthLabel && cfg.sizeLabelKey) {
                                    widthLabel.textContent = getTranslation(cfg.sizeLabelKey) || cfg.sizeLabel || 'Size';
                                    widthLabel.setAttribute('data-i18n', cfg.sizeLabelKey);
                                } else if (widthLabel && cfg.sizeLabel) {
                                    widthLabel.textContent = cfg.sizeLabel;
                                }
                                if (widthSelect) {
                                    widthSelect.innerHTML = '';
                                    cfg.sizeOptions.forEach(opt => {
                                        const option = document.createElement('option');
                                        option.value = opt.value;
                                        option.textContent = opt.i18nKey ? (getTranslation(opt.i18nKey) || opt.label || opt.value) : (opt.label || opt.value);
                                        option.setAttribute('data-i18n', opt.i18nKey || '');
                                        if (!opt.enabled) {
                                            option.disabled = true;
                                            option.style.color = '#ccc';
                                        }
                                        if (opt.selected) option.selected = true;
                                        widthSelect.appendChild(option);
                                    });
                                }
                            }
                        } else {
                            // Default lamination quantities
                            const qtySelect = document.getElementById('quantity-select');
                            if (qtySelect) {
                                qtySelect.innerHTML = '';
                                [1, 2, 3, 4, 5, 6, 7, 8, 9, 10].forEach(q => {
                                    const opt = document.createElement('option');
                                    opt.value = q;
                                    opt.textContent = q;
                                    qtySelect.appendChild(opt);
                                });
                            }
                        }

                        // Initialize specific logic if available
                        if (typeof window.initLaminationLogic === 'function') {
                            const savedLang = localStorage.getItem('preferred-lang') || 'mn';
                            setTimeout(() => window.initLaminationLogic(savedLang, data), 50);
                        }
                    }

                    // Update Page Title and Header
                    const translatedName = data.nameKey ? (getTranslation(data.nameKey) || data.name) : data.name;
                    document.title = `PPM | ${translatedName}`;
                    const titleEl = document.querySelector('.product-form-card h2');
                    if (titleEl) {
                        titleEl.textContent = translatedName;
                        if (data.nameKey) {
                            titleEl.setAttribute('data-i18n', data.nameKey);
                        }
                    }

                    // Update Breadcrumb
                    const breadcrumbNav = document.querySelector('.breadcrumb');
                    const breadcrumbSpan = breadcrumbNav ? breadcrumbNav.querySelector('span:last-child') : null;

                    // Fix Breadcrumb for Inventory products
                    if (breadcrumbNav && ((data.stock && data.stock !== 'Захиалгаар') || data.isLamination)) {
                        const quoteLink = breadcrumbNav.querySelector('a[href="quote.html"]');
                        if (quoteLink) {
                            quoteLink.href = 'inventory.html';
                            quoteLink.setAttribute('data-i18n', 'nav-inventory');
                            quoteLink.textContent = getTranslation('nav-inventory') || 'Бараа материал';
                        }
                    }

                    if (breadcrumbSpan) {
                        breadcrumbSpan.textContent = translatedName;
                        if (data.nameKey) {
                            breadcrumbSpan.setAttribute('data-i18n', data.nameKey);
                        }
                    }

                    // Update Product Description
                    const descEl = document.getElementById('product-detail-description');
                    if (descEl) {
                        const translatedDesc = data.descKey ? (getTranslation(data.descKey) || data.desc) : data.desc;
                        descEl.textContent = translatedDesc;
                        if (data.descKey) {
                            descEl.setAttribute('data-i18n', data.descKey);
                        }
                    }

                    // Update Image Gallery
                    const galleryGrid = document.querySelector('.thumbnail-grid');
                    const mainImg = document.getElementById('current-main-img');

                    if (data.images && data.images.length > 0 && mainImg) {
                        mainImg.src = data.images[0];
                        mainImg.alt = data.name;

                        if (galleryGrid) {
                            galleryGrid.innerHTML = '';
                            data.images.forEach((url, index) => {
                                const thumbDiv = document.createElement('div');
                                thumbDiv.className = `thumb ${index === 0 ? 'active' : ''}`;
                                thumbDiv.style.cursor = 'pointer';

                                thumbDiv.onclick = function () {
                                    mainImg.src = url;
                                    document.querySelectorAll('.thumbnail-grid .thumb').forEach(t => t.classList.remove('active'));
                                    this.classList.add('active');
                                };

                                thumbDiv.innerHTML = `<img src="${url}" alt="Product Image ${index + 1}" style="width:100px; height:auto;">`;
                                galleryGrid.appendChild(thumbDiv);
                            });
                        }
                    } else if (data.img && mainImg) {
                        mainImg.src = data.img;
                        mainImg.alt = data.name;
                        if (galleryGrid) galleryGrid.innerHTML = '';
                    }

                    // Dynamic Options & Configuration (Standard Products)
                    if (data.formConfig && !data.isLamination) {
                        const config = data.formConfig;

                        // Helper to populate select
                        const populate = (id, options) => {
                            const select = document.getElementById(id);
                            if (select && options) {
                                select.innerHTML = '';
                                options.forEach(opt => {
                                    const el = document.createElement('option');
                                    if (opt.key !== undefined) {
                                        el.textContent = opt.val;
                                        if (opt.key) el.setAttribute('data-i18n', opt.key);
                                    } else {
                                        el.textContent = opt;
                                        el.value = opt;
                                    }
                                    select.appendChild(el);
                                });
                            }
                        };

                        if (config.formats) populate('format-select', config.formats);
                        if (config.quantities) populate('quantity-select', config.quantities);
                        if (config.papers) populate('paper-select', config.papers);
                        if (config.pages) populate('pages-select', config.pages);
                        if (config.covers) populate('cover-select', config.covers);

                        const bindingSelect = document.querySelector('select[name="binding"]');
                        if (config.bindings && bindingSelect) {
                            bindingSelect.innerHTML = '';
                            const ph = document.createElement('option');
                            ph.setAttribute('data-i18n', 'form-folding-select');
                            ph.textContent = 'Сонгох';
                            bindingSelect.appendChild(ph);
                            config.bindings.forEach(b => {
                                const el = document.createElement('option');
                                el.textContent = b.val;
                                if (b.key) el.setAttribute('data-i18n', b.key);
                                bindingSelect.appendChild(el);
                            });
                        }

                        const coatingSelect = document.querySelector('select[name="coating"]');
                        if (config.coatings && coatingSelect) {
                            coatingSelect.innerHTML = '';
                            config.coatings.forEach(c => {
                                const el = document.createElement('option');
                                el.textContent = c.val;
                                if (c.key) el.setAttribute('data-i18n', c.key);
                                coatingSelect.appendChild(el);
                            });
                        }

                        // Visibility Helper
                        const setDisplay = (id, show) => {
                            const el = document.getElementById(id);
                            if (el) el.style.display = show ? 'block' : 'none';
                        };

                        setDisplay('pages-group', config.showPages);
                        setDisplay('cover-group', config.showCover);
                        setDisplay('binding-group', config.showBinding);
                        setDisplay('folding-group', config.showFolding);
                        setDisplay('varnish-group', config.showVarnish);
                        setDisplay('print-type-group', config.showPrintType !== false);
                        setDisplay('prepress-group', config.showPrepress !== false);
                        setDisplay('coating-group', config.showCoating !== false);
                        setDisplay('cut-select-group', config.showCutSelect);
                        setDisplay('cut-checkbox-group', config.showCutCheckbox);
                        setDisplay('numbered-group', config.showNumbered);
                        setDisplay('target-price-group', config.showTargetPrice);
                        setDisplay('delivery-date-group', config.showDeliveryDate !== false);
                        setDisplay('delivery-info-group', config.showDeliveryInfo !== false); // Default true

                        // Foil & Spot UV
                        const foilGroup = document.getElementById('foil-group');
                        if (foilGroup) {
                            foilGroup.style.display = config.showFoil !== false ? 'block' : 'none';
                            const foilLabel = foilGroup.querySelector('span[data-i18n]');
                            if (foilLabel) foilLabel.setAttribute('data-i18n', config.labelFoil || 'form-foil');
                        }

                        const spotGroup = document.getElementById('spot-uv-group');
                        if (spotGroup) {
                            spotGroup.style.display = config.showSpotUV !== false ? 'block' : 'none';
                            const spotLabel = spotGroup.querySelector('span[data-i18n]');
                            if (spotLabel) spotLabel.setAttribute('data-i18n', config.labelSpotUV || 'form-spot-uv');
                        }

                        // Labels
                        if (config.labelFormat) {
                            const l = document.querySelector('#format-group label');
                            if (l) l.textContent = config.labelFormat;
                        }
                        if (config.labelPaper) {
                            const l = document.querySelector('#paper-group label');
                            if (l) l.setAttribute('data-i18n', config.labelPaper);
                        }

                        // Ensure standard groups are visible if not explicitly hidden
                        if (config.showFormat !== false) document.getElementById('format-group').style.display = 'block';
                        if (config.showPaper !== false) document.getElementById('paper-group').style.display = 'block';
                        document.getElementById('quantity-group').style.display = 'block';

                        // Checkbox groups
                        if (config.showCutCheckbox) {
                            document.getElementById('cut-checkbox-group').style.display = 'block';
                        }
                    } else if (!data.isLamination) {
                        // Fallback logic for products without specific config (though now all should have one)
                        const genericGroups = ['pages-group', 'cover-group', 'binding-group', 'folding-group', 'varnish-group', 'prepress-group'];
                        genericGroups.forEach(id => {
                            const el = document.getElementById(id);
                            if (el) el.style.display = 'none';
                        });
                        const qtyGroup = document.getElementById('quantity-group');
                        if (qtyGroup) qtyGroup.style.display = 'block';
                    }

                    // Apply translations after form setup
                    const savedLang = localStorage.getItem('preferred-lang') || 'mn';
                    if (typeof setLanguage === 'function') {
                        setTimeout(() => setLanguage(savedLang), 150);
                    }
                }
            }, 100); // Small delay to ensure other scripts have run
        });
    </script>
</body>

</html>